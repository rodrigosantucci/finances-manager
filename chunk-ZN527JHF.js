import{f as At,h as A,i as Rt,j as $t,k as jt,l as li,m as mi}from"./chunk-HVJTVYJO.js";import{h as qt,i as Zt,j as Wt,l as Qt,m as Yt,o as Jt,p as ei,r as ti,s as ii,u as ni,v as ri,w as ai,x as $e,y as oi,z as si}from"./chunk-5XWROIXO.js";import"./chunk-PYM2POMD.js";import{i as ci,j as di,l as pi,q as ui}from"./chunk-F7SIOTBY.js";import{d as gi}from"./chunk-QEDBGLFO.js";import{c as ne,d as re}from"./chunk-PDKMJN2Z.js";import{d as zt,f as Kt,g as Bt,h as Nt}from"./chunk-4A3OJW5V.js";import{a as Gt,b as Ht,e as Xt}from"./chunk-MN4LMCKE.js";import{a as ze,b as Ke}from"./chunk-XQJT4HS4.js";import{a as Vt,b as Lt}from"./chunk-MJCEQZQC.js";import{b as It,d as Ve,e as kt,f as Ut,h as Le,i as Tt,n as j,o as G,r as Dt,t as Re,v as F,x as Ft}from"./chunk-AGRABIDD.js";import{Bb as te,Cb as ie,Da as St,Eb as Se,Gb as O,Ja as R,Jb as Ae,Kb as Ee,La as $,Oa as z,Pa as ye,Qb as Ie,Ta as Y,Ua as K,Ub as ke,Vb as Ue,_b as Et,ac as Te,bc as De,cc as Fe,d as Pt,e as D,gc as B,ic as N,ja as yt,k as Me,pa as Ot,q as xt,r as wt,s as Mt,ub as J,vb as Oe,yb as ee}from"./chunk-BL6LWGXP.js";import{Ac as Pe,Bc as bt,Ca as ct,D as le,Da as dt,Db as Ce,Eb as _,F as ge,Gc as P,H as st,Hc as x,Ic as xe,Ja as pt,K as fe,Kb as V,Lb as d,Lc as Ye,Mb as Ge,Nb as Z,Pb as ft,Pc as Q,Ra as ut,Sa as gt,Sb as y,Sc as Je,Tb as He,Tc as et,Ub as Xe,Vb as qe,W as me,Wb as r,Xb as o,Yb as b,Z as q,Zb as I,_b as k,aa as lt,ac as S,ba as _e,da as mt,dc as C,fc as p,ga as g,gc as _t,hb as he,hc as ht,hd as we,ic as vt,jb as s,kd as Ct,lc as Ze,m as X,mc as We,nc as Qe,pd as L,q as ot,qc as W,ra as w,rb as ve,rc as m,sa as M,sc as h,tc as U,xb as E,yb as be}from"./chunk-ZR6WDTF5.js";import{a as se,b as ue}from"./chunk-4X36HX5K.js";var fi=(()=>{class n{constructor(){this.auth=g(F),this.router=g(wt),this.http=g(D),this.sanitizer=g(Me),this.dashboardService=g(jt),this.defaultAvatarPlaceholder="images/avatar.jpg",this.apiUrl=A.baseUrl,this.avatarObjectUrl=null,this.avatarUrl=this.defaultAvatarPlaceholder,this.isLoadingUser=!0}ngOnInit(){this.auth.user().pipe(fe((e,t)=>e.id===t.id),q(e=>{this.user=e,this.loadAvatar(e.id),this.isLoadingUser=!1}),ge(100)).subscribe()}logout(){this.auth.logout().subscribe(()=>{this.dashboardService.clearPatrimonioCache(),this.router.navigateByUrl("/auth/login")})}loadAvatar(e){if(!e){console.warn("ProfileLayoutComponent: No user ID provided for avatar loading"),this.avatarUrl=this.defaultAvatarPlaceholder;return}this.http.get(`${this.apiUrl}/api/avatars/${e}`,{responseType:"blob"}).subscribe({next:t=>{this.avatarObjectUrl&&URL.revokeObjectURL(this.avatarObjectUrl),this.avatarObjectUrl=URL.createObjectURL(t),this.avatarUrl=this.sanitizer.bypassSecurityTrustUrl(this.avatarObjectUrl)},error:t=>{console.warn("ProfileLayoutComponent: Failed to load avatar:",t),t instanceof Pt&&t.status===404?this.avatarUrl=this.defaultAvatarPlaceholder:(console.error("ProfileLayoutComponent: An unexpected error occurred while loading avatar."),this.avatarUrl=this.defaultAvatarPlaceholder)}})}ngOnDestroy(){this.avatarObjectUrl&&(URL.revokeObjectURL(this.avatarObjectUrl),this.avatarObjectUrl=null)}onImageError(e){console.warn("ProfileLayoutComponent: Image failed to load:",e.target.src),e.target.src=this.defaultAvatarPlaceholder,this.avatarUrl=this.defaultAvatarPlaceholder}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-profile-layout"]],decls:26,vars:11,consts:[[1,"bg-dark","text-light",3,"title"],[1,"row"],[1,"col-sm-4","col-md-4","col-lg-3"],[1,"text-center"],["alt","user avatar","width","150","height","150",1,"m-b-8","r-full",3,"error","src"],[1,"m-t-0","m-b-8","f-w-400"],[1,"m-t-0","text-grey-500"],[1,"m-t-16","m-b-8"],["mat-list-item","","routerLink","/profile/overview"],["matListItemIcon",""],["mat-list-item","","tabindex","0",3,"click","keydown.enter"],[1,"col-sm-8","col-md-8","col-lg-9"]],template:function(t,i){t&1&&(b(0,"page-header",0),P(1,"translate"),r(2,"div",1)(3,"div",2)(4,"mat-card")(5,"mat-card-content")(6,"div",3)(7,"img",4),C("error",function(c){return i.onImageError(c)}),o(),r(8,"h2",5),m(9),o(),r(10,"p",6),m(11,"Let's make money."),o()(),b(12,"mat-divider",7),r(13,"mat-nav-list")(14,"a",8)(15,"mat-icon",9),m(16,"account_circle"),o(),m(17),P(18,"translate"),o(),r(19,"a",10),C("click",function(){return i.logout()})("keydown.enter",function(){return i.logout()}),r(20,"mat-icon",9),m(21,"exit_to_app"),o(),m(22),P(23,"translate"),o()()()()(),r(24,"div",11),b(25,"router-outlet"),o()()),t&2&&(vt("title",x(1,5,"profile")),s(7),d("src",i.avatarUrl,he),s(2),h(i.user.username),s(8),U(" ",x(18,7,"profile")," "),s(5),U(" ",x(23,9,"logout")," "))},dependencies:[Mt,xt,K,z,R,$,Lt,Vt,Nt,Bt,Kt,zt,G,j,Dt,N,B],encapsulation:2})}}return n})();var oe=(()=>{class n{constructor(){this.http=g(D),this.authService=g(F),this.storage=g(Re),this.apiUsuariosPrefix="/api/usuarios/",this.apiAvatarsPrefix="/api/avatars/"}getUsuarioIdObservable(){return this.authService.user().pipe(st(1),ot(e=>e?.id))}getProfile(){return this.getUsuarioIdObservable().pipe(me(e=>{if(e==null)return console.error("SettingsService: ID do usu\xE1rio n\xE3o dispon\xEDvel para buscar perfil."),X(null);let t=`${this.apiUsuariosPrefix}${e}`;return console.log(`SettingsService: Solicitando perfil para usu\xE1rio ID: ${e} da URL: ${t}`),this.http.get(t).pipe(q(i=>console.log(`SettingsService: Perfil recebido para usu\xE1rio ${e}:`,i)),le(i=>(console.error(`SettingsService: Erro ao buscar perfil para usu\xE1rio ${e}:`,i),X(null))))}))}updateProfile(e){return this.getUsuarioIdObservable().pipe(me(t=>{if(t==null)return console.error("SettingsService: ID do usu\xE1rio n\xE3o dispon\xEDvel para atualizar perfil."),X(null);let i=`${this.apiUsuariosPrefix}${t}`;return console.log(`SettingsService: Enviando atualiza\xE7\xE3o de perfil para usu\xE1rio ID: ${t} da URL: ${i}`),this.http.put(i,e).pipe(q(a=>console.log(`SettingsService: Perfil atualizado com sucesso para usu\xE1rio ${t}:`,a)),le(a=>(console.error(`SettingsService: Erro ao atualizar perfil para usu\xE1rio ${t}:`,a),X(null))))}))}getAISettings(){let e=this.storage.get("ai.provider"),t=this.storage.get("ai.geminiKey")??this.storage.get("ai.key.gemini"),i=this.storage.get("ai.openaiKey")??this.storage.get("ai.key.openai"),a=this.storage.get("ai.backendEndpoint"),c=!!this.storage.get("ai.active.openai"),u=!!this.storage.get("ai.active.gemini");return{provider:e,geminiApiKey:t,openaiApiKey:i,aiBackendEndpoint:a,activeOpenAI:c,activeGemini:u}}updateAISettings(e){return this.storage.set("ai.provider",e.provider??null),this.storage.set("ai.key.gemini",e.geminiApiKey??null),this.storage.set("ai.key.openai",e.openaiApiKey??null),this.storage.set("ai.backendEndpoint",e.aiBackendEndpoint??null),this.storage.set("ai.active.openai",e.activeOpenAI??null),this.storage.set("ai.active.gemini",e.activeGemini??null),!0}getFullAvatarUrl(e){return e==null?"":`${this.apiAvatarsPrefix}${e}`}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=lt({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Si(n,l){if(n&1){let e=S();r(0,"img",20),C("error",function(i){w(e);let a=p();return M(a.onImageError(i))}),o()}if(n&2){let e=p();d("src",e.avatarPreviewUrl,he)}}function Ai(n,l){n&1&&b(0,"mat-spinner",4)}function Ei(n,l){if(n&1&&(r(0,"mat-error",7),m(1),o()),n&2){let e=p();s(),h(e.avatarError)}}function Ii(n,l){if(n&1&&(r(0,"mat-error"),m(1),o()),n&2){let e=p();s(),h(e.getErrorMessage("username"))}}function ki(n,l){if(n&1&&(r(0,"mat-error"),m(1),o()),n&2){let e=p();s(),h(e.getErrorMessage("email"))}}function Ui(n,l){if(n&1&&(r(0,"mat-error"),m(1),o()),n&2){let e=p();s(),h(e.getPasswordErrorMessage())}}function Ti(n,l){if(n&1&&(r(0,"mat-option",16),m(1),o()),n&2){let e=l.$implicit;d("value",e),s(),h(e)}}function Di(n,l){if(n&1&&(r(0,"mat-error"),m(1),o()),n&2){let e=p();s(),h(e.getErrorMessage("estrategia"))}}function Fi(n,l){if(n&1&&(r(0,"mat-option",16),m(1),o()),n&2){let e=l.$implicit;d("value",e),s(),h(e)}}function Vi(n,l){if(n&1&&(r(0,"mat-error"),m(1),o()),n&2){let e=p();s(),h(e.getErrorMessage("perfil"))}}function Li(n){let l=n.get("password"),e=n.get("confirmPassword");return!l||!e?null:!l.value&&!e.value?(e.setErrors(null),null):l.value!==e.value?(e.setErrors({passwordMismatch:!0}),{passwordMismatch:!0}):(e.hasError("passwordMismatch")&&e.setErrors(null),null)}var bi=(()=>{class n{constructor(){this.auth=g(F),this.fb=g(Te),this.settingsService=g(oe),this.http=g(D),this.sanitizer=g(Me),this.cdr=g(Q),this.selectedFile=null,this.avatarPreviewUrl=null,this.avatarError=null,this.defaultAvatarPlaceholder="images/avatar.jpg",this.avatarObjectUrl=null,this.isLoadingAvatar=!0,this.perfilOptions=["Conservador","Intermedi\xE1rio","Agressivo"],this.estrategiaOptions=["Defensiva","Equilibrado","Ofensiva"],this.passwordVisibility={password:!1,confirmPassword:!1}}ngOnInit(){console.log("ProfileSettingsComponent: Initializing"),this.auth.user().pipe(fe((e,t)=>e.id===t.id),q(e=>{console.log("ProfileSettingsComponent: User received",e),this.user=e,this.loadUserData(),this.loadAvatar(e.id)}),ge(100)).subscribe(),this.reactiveForm=this.fb.group({username:this.fb.control("",{validators:[O.required],nonNullable:!0}),email:this.fb.control("",{validators:[O.required,O.email],nonNullable:!0}),password:this.fb.control("",{nonNullable:!0}),confirmPassword:this.fb.control("",{nonNullable:!0}),estrategia:this.fb.control("",{validators:[O.required],nonNullable:!0}),perfil:this.fb.control("",{validators:[O.required],nonNullable:!0}),avatarIdentifier:this.fb.control(void 0),id:this.fb.control(void 0)},{validators:Li})}loadUserData(){console.log("ProfileSettingsComponent: Loading user data"),this.settingsService.getProfile().subscribe({next:e=>{e?(console.log("ProfileSettingsComponent: Profile data loaded",e),this.reactiveForm.patchValue({username:e.username,email:e.email,estrategia:e.estrategia,perfil:e.perfil,id:e.id,avatarIdentifier:e.avatarIdentifier})):(console.warn("ProfileSettingsComponent: No profile data loaded, using placeholder"),this.avatarPreviewUrl=this.defaultAvatarPlaceholder,this.isLoadingAvatar=!1,this.cdr.detectChanges())},error:e=>{console.error("ProfileSettingsComponent: Error loading profile data:",e),this.avatarPreviewUrl=this.defaultAvatarPlaceholder,this.isLoadingAvatar=!1,this.cdr.detectChanges()}})}loadAvatar(e){if(!e){console.warn("ProfileSettingsComponent: No user ID provided for avatar loading"),this.avatarPreviewUrl=this.defaultAvatarPlaceholder,this.isLoadingAvatar=!1,this.cdr.detectChanges();return}console.log("ProfileSettingsComponent: Fetching avatar for ID:",e);let t=`t=${Date.now()}`;this.http.get(`${A.baseUrl}/api/avatars/${e}?${t}`,{responseType:"blob"}).subscribe({next:i=>{console.log("ProfileSettingsComponent: Avatar loaded for ID:",e),this.avatarObjectUrl&&URL.revokeObjectURL(this.avatarObjectUrl),this.avatarObjectUrl=URL.createObjectURL(i),this.avatarPreviewUrl=this.sanitizer.bypassSecurityTrustUrl(this.avatarObjectUrl),this.isLoadingAvatar=!1,this.cdr.detectChanges()},error:i=>{console.warn("ProfileSettingsComponent: Failed to load avatar:",i),i.status===404?(console.log("ProfileSettingsComponent: Avatar not found (404), showing placeholder"),this.avatarPreviewUrl=this.defaultAvatarPlaceholder):(console.error("ProfileSettingsComponent: Unexpected error loading avatar:",i),this.avatarPreviewUrl=this.defaultAvatarPlaceholder),this.isLoadingAvatar=!1,this.cdr.detectChanges()}})}onFileSelected(e){console.log("ProfileSettingsComponent: File selected");let t=e.target;if(t.files&&t.files.length>0){let i=t.files[0];if(this.avatarError=null,!["image/jpeg","image/png"].includes(i.type)){this.avatarError="Apenas arquivos JPEG e PNG s\xE3o permitidos.",this.selectedFile=null,this.avatarPreviewUrl=this.defaultAvatarPlaceholder,t.value="",this.isLoadingAvatar=!1,this.cdr.detectChanges();return}let c=2*1024*1024;if(i.size>c){this.avatarError="O tamanho do arquivo n\xE3o pode exceder 2MB.",this.selectedFile=null,this.avatarPreviewUrl=this.defaultAvatarPlaceholder,t.value="",this.isLoadingAvatar=!1,this.cdr.detectChanges();return}this.selectedFile=i;let u=new FileReader;u.onload=()=>{this.avatarPreviewUrl=u.result,this.isLoadingAvatar=!1,this.cdr.detectChanges()},u.readAsDataURL(i)}else this.selectedFile=null,this.loadAvatar(this.user.id)}getErrorMessage(e){let t=this.reactiveForm.get(e);return!t||!t.touched?"":t.hasError("required")?"Este campo \xE9 obrigat\xF3rio.":t.hasError("email")?"Por favor, insira um e-mail v\xE1lido.":t.hasError("pattern")?"Por favor, insira uma URL v\xE1lida.":t.hasError("minlength")?"Deve ter no m\xEDnimo 20 caracteres.":t.hasError("invalidEndpoint")?"Endpoint inv\xE1lido ou indispon\xEDvel.":""}togglePasswordVisibility(e){this.passwordVisibility[e]=!this.passwordVisibility[e],this.cdr.detectChanges()}getPasswordErrorMessage(){let e=this.reactiveForm.get("confirmPassword");return!e||!e.touched?"":e.hasError("passwordMismatch")?"As senhas n\xE3o coincidem.":""}getAIKeyErrorMessage(e){let t=this.reactiveForm.get(e);return!t||!t.touched?"":t.hasError("required")?"API key \xE9 obrigat\xF3ria.":t.hasError("minlength")?"Deve ter no m\xEDnimo 20 caracteres.":t.hasError("pattern")?"Formato de API key inv\xE1lido.":""}onSubmit(){console.log("ProfileSettingsComponent: Submitting form"),this.reactiveForm.markAllAsTouched();let e=this.reactiveForm.get("password")?.value,t=this.reactiveForm.get("confirmPassword")?.value;if(e&&e.length>0){if(!t||t.length===0){this.reactiveForm.get("confirmPassword")?.setErrors({required:!0}),this.reactiveForm.get("confirmPassword")?.markAsTouched(),console.log("ProfileSettingsComponent: Confirma\xE7\xE3o de senha \xE9 obrigat\xF3ria");return}if(e!==t){this.reactiveForm.get("confirmPassword")?.setErrors({passwordMismatch:!0}),this.reactiveForm.get("confirmPassword")?.markAsTouched(),console.log("ProfileSettingsComponent: As senhas n\xE3o coincidem");return}}else this.reactiveForm.get("confirmPassword")?.setErrors(null);if(this.reactiveForm.invalid&&!this.selectedFile){console.log("ProfileSettingsComponent: Formul\xE1rio inv\xE1lido e nenhum arquivo selecionado");return}let i=new FormData,a=this.reactiveForm.getRawValue();i.append("username",a.username),i.append("email",a.email),i.append("estrategia",a.estrategia),i.append("perfil",a.perfil),a.password&&a.password.length>0&&i.append("password",a.password),this.selectedFile&&i.append("avatar",this.selectedFile,this.selectedFile.name),this.isLoadingAvatar=!0,this.cdr.detectChanges(),this.settingsService.updateProfile(i).subscribe({next:c=>{c?(console.log("ProfileSettingsComponent: Perfil atualizado com sucesso",c),alert("Perfil atualizado com sucesso!"),this.reactiveForm.patchValue({id:c.id,avatarIdentifier:c.avatarIdentifier}),c.id&&this.loadAvatar(c.id)):(console.error("ProfileSettingsComponent: Erro ao atualizar perfil: Resposta nula"),alert("Erro ao atualizar perfil"),this.loadAvatar(this.user.id)),this.selectedFile=null,this.reactiveForm.get("password")?.reset(""),this.reactiveForm.get("confirmPassword")?.reset(""),this.reactiveForm.markAsPristine(),this.reactiveForm.markAsUntouched(),this.cdr.detectChanges()},error:c=>{console.error("ProfileSettingsComponent: Erro ao atualizar perfil:",c),alert("Erro ao atualizar perfil"),this.loadAvatar(this.user.id),this.isLoadingAvatar=!1,this.cdr.detectChanges()}})}onImageError(e){console.warn("ProfileSettingsComponent: Image failed to load:",e.target.src),e.target.src=this.defaultAvatarPlaceholder,this.avatarPreviewUrl=this.defaultAvatarPlaceholder,this.isLoadingAvatar=!1,this.cdr.detectChanges()}ngOnDestroy(){console.log("ProfileSettingsComponent: Destroying"),this.avatarObjectUrl&&(URL.revokeObjectURL(this.avatarObjectUrl),this.avatarObjectUrl=null)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-profile-settings"]],features:[Pe([Ot(),oe])],decls:72,vars:51,consts:[["fileInput",""],[1,"form-field-full",3,"ngSubmit","formGroup"],[1,"avatar-section","m-b-16"],["alt","user avatar","width","130","height","130",1,"m-b-8","r-full",3,"src"],["diameter","40",1,"m-b-8"],["type","file","accept","image/jpeg,image/png",2,"display","none",3,"change"],["mat-stroked-button","","color","primary","type","button",3,"click"],[1,"m-t-8"],[1,"inputs-grid"],[1,"input-cell"],["matInput","","formControlName","username","required","",3,"placeholder"],["matInput","","formControlName","email","required","",3,"placeholder"],["matInput","","formControlName","password",3,"type","placeholder"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matInput","","formControlName","confirmPassword",3,"type","placeholder"],["formControlName","estrategia","required",""],[3,"value"],["formControlName","perfil","required",""],[1,"save-button-container","m-t-16"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["alt","user avatar","width","130","height","130",1,"m-b-8","r-full",3,"error","src"]],template:function(t,i){if(t&1){let a=S();r(0,"mat-card")(1,"mat-card-content")(2,"form",1),C("ngSubmit",function(){return w(a),M(i.onSubmit())}),r(3,"div",2),_(4,Si,1,1,"img",3)(5,Ai,1,0,"mat-spinner",4),r(6,"input",5,0),C("change",function(u){return w(a),M(i.onFileSelected(u))}),o(),r(8,"button",6),C("click",function(){w(a);let u=W(7);return M(u.click())}),m(9),P(10,"translate"),o(),_(11,Ei,2,1,"mat-error",7),o(),r(12,"div",8)(13,"div",9)(14,"mat-form-field")(15,"mat-label"),m(16),P(17,"translate"),o(),b(18,"input",10),P(19,"translate"),_(20,Ii,2,1,"mat-error"),o()(),r(21,"div",9)(22,"mat-form-field")(23,"mat-label"),m(24),P(25,"translate"),o(),b(26,"input",11),P(27,"translate"),_(28,ki,2,1,"mat-error"),o()(),r(29,"div",9)(30,"mat-form-field")(31,"mat-label"),m(32),P(33,"translate"),o(),b(34,"input",12),P(35,"translate"),r(36,"button",13),C("click",function(){return w(a),M(i.togglePasswordVisibility("password"))}),r(37,"mat-icon"),m(38),o()()()(),r(39,"div",9)(40,"mat-form-field")(41,"mat-label"),m(42),P(43,"translate"),o(),b(44,"input",14),P(45,"translate"),r(46,"button",13),C("click",function(){return w(a),M(i.togglePasswordVisibility("confirmPassword"))}),r(47,"mat-icon"),m(48),o()(),_(49,Ui,2,1,"mat-error"),o()(),r(50,"div",9)(51,"mat-form-field")(52,"mat-label"),m(53),P(54,"translate"),o(),r(55,"mat-select",15),Xe(56,Ti,2,2,"mat-option",16,He),o(),_(58,Di,2,1,"mat-error"),o()(),r(59,"div",9)(60,"mat-form-field")(61,"mat-label"),m(62),P(63,"translate"),o(),r(64,"mat-select",17),Xe(65,Fi,2,2,"mat-option",16,He),o(),_(67,Vi,2,1,"mat-error"),o()()(),r(68,"div",18)(69,"button",19),m(70),P(71,"translate"),o()()()()()}if(t&2){let a,c,u,v,f;s(2),d("formGroup",i.reactiveForm),s(2),y(i.isLoadingAvatar?5:4),s(5),U(" ",x(10,27,"settings.update_avatar")," "),s(2),y(i.avatarError?11:-1),s(5),h(x(17,29,"settings.fields.name")),s(2),d("placeholder",x(19,31,"settings.placeholders.name")),s(2),y((a=i.reactiveForm.get("username"))!=null&&a.invalid&&((a=i.reactiveForm.get("username"))!=null&&a.touched)?20:-1),s(4),h(x(25,33,"settings.fields.email")),s(2),d("placeholder",x(27,35,"settings.placeholders.email")),s(2),y((c=i.reactiveForm.get("email"))!=null&&c.invalid&&((c=i.reactiveForm.get("email"))!=null&&c.touched)?28:-1),s(4),h(x(33,37,"settings.fields.password")),s(2),d("type",i.passwordVisibility.password?"text":"password")("placeholder",x(35,39,"settings.placeholders.new_password_optional")),s(2),V("aria-label",i.passwordVisibility.password?"Ocultar senha":"Mostrar senha"),s(2),h(i.passwordVisibility.password?"visibility_off":"visibility"),s(4),h(x(43,41,"settings.fields.confirm_password")),s(2),d("type",i.passwordVisibility.confirmPassword?"text":"password")("placeholder",x(45,43,"settings.placeholders.confirm_password")),s(2),V("aria-label",i.passwordVisibility.confirmPassword?"Ocultar senha":"Mostrar senha"),s(2),h(i.passwordVisibility.confirmPassword?"visibility_off":"visibility"),s(),y((u=i.reactiveForm.get("confirmPassword"))!=null&&u.invalid&&((u=i.reactiveForm.get("confirmPassword"))!=null&&u.touched)?49:-1),s(4),h(x(54,45,"settings.fields.strategy")),s(3),qe(i.estrategiaOptions),s(2),y((v=i.reactiveForm.get("estrategia"))!=null&&v.invalid&&((v=i.reactiveForm.get("estrategia"))!=null&&v.touched)?58:-1),s(4),h(x(63,47,"settings.fields.profile")),s(3),qe(i.perfilOptions),s(2),y((f=i.reactiveForm.get("perfil"))!=null&&f.invalid&&((f=i.reactiveForm.get("perfil"))!=null&&f.touched)?67:-1),s(2),d("disabled",i.reactiveForm.invalid&&!i.selectedFile),s(),U(" ",x(71,49,"common.save")," ")}},dependencies:[L,De,Ie,Se,Ae,Ee,Et,Fe,ke,Ue,K,ye,Y,z,R,$,ie,te,J,Oe,ee,re,ne,G,j,Ke,ze,Ve,It,St,N,B],styles:['@charset "UTF-8";.avatar-preview[_ngcontent-%COMP%]{width:150px;height:150px;object-fit:cover;border:2px solid #ccc;border-radius:40%;box-shadow:0 2px 4px #0000001a}.m-b-8[_ngcontent-%COMP%]{margin-bottom:8px}.m-b-16[_ngcontent-%COMP%]{margin-bottom:16px}.m-t-8[_ngcontent-%COMP%]{margin-top:8px}.m-t-16[_ngcontent-%COMP%]{margin-top:16px}.d-flex[_ngcontent-%COMP%]{display:flex}.flex-column[_ngcontent-%COMP%]{flex-direction:column}.align-items-center[_ngcontent-%COMP%]{align-items:center}.justify-content-center[_ngcontent-%COMP%]{justify-content:center}[_nghost-%COMP%]   .form-grid-row[_ngcontent-%COMP%]{gap:12px 8px}[_nghost-%COMP%]   .form-grid-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   form.form-field-full[_ngcontent-%COMP%]   .form-grid-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}@media (width <= 600px){[_nghost-%COMP%]   form.form-field-full[_ngcontent-%COMP%]   .form-grid-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}}[_nghost-%COMP%]   .avatar-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]   .save-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center}[_nghost-%COMP%]   .avatar-section[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}[_nghost-%COMP%]   .inputs-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px 16px}[_nghost-%COMP%]   .inputs-grid[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}mat-card[_ngcontent-%COMP%], .mat-mdc-card[_ngcontent-%COMP%], .mdc-card[_ngcontent-%COMP%], .mat-mdc-card-outlined[_ngcontent-%COMP%], .mdc-card--outlined[_ngcontent-%COMP%]{background:transparent!important;border:none!important;box-shadow:none!important}mat-card[_ngcontent-%COMP%]:hover, .mat-mdc-card[_ngcontent-%COMP%]:hover{box-shadow:none!important;transform:none!important}mat-card-content[_ngcontent-%COMP%], .mat-mdc-card-content[_ngcontent-%COMP%]{background:transparent!important}']})}}return n})();function Ri(n,l){n&1&&b(0,"div",2)}var $i=new mt("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var Pi=(()=>{class n{_elementRef=g(pt);_ngZone=g(dt);_changeDetectorRef=g(Q);_renderer=g(ve);_cleanupTransitionEnd;_animationMode=g(gt,{optional:!0});constructor(){let e=g($i,{optional:!0});this._isNoopAnimation=this._animationMode==="NoopAnimations",e&&(e.color&&(this.color=this._defaultColor=e.color),this.mode=e.mode||this.mode)}_isNoopAnimation=!1;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;_defaultColor="primary";get value(){return this._value}set value(e){this._value=Ci(e||0),this._changeDetectorRef.markForCheck()}_value=0;get bufferValue(){return this._bufferValue||0}set bufferValue(e){this._bufferValue=Ci(e||0),this._changeDetectorRef.markForCheck()}_bufferValue=0;animationEnd=new ct;get mode(){return this._mode}set mode(e){this._mode=e,this._changeDetectorRef.markForCheck()}_mode="determinate";ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._cleanupTransitionEnd=this._renderer.listen(this._elementRef.nativeElement,"transitionend",this._transitionendHandler)})}ngOnDestroy(){this._cleanupTransitionEnd?.()}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}_transitionendHandler=e=>{this.animationEnd.observers.length===0||!e.target||!e.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))};static \u0275fac=function(t){return new(t||n)};static \u0275cmp=E({type:n,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(t,i){t&2&&(V("aria-valuenow",i._isIndeterminate()?null:i.value)("mode",i.mode),ft("mat-"+i.color),Z("_mat-animation-noopable",i._isNoopAnimation)("mdc-linear-progress--animation-ready",!i._isNoopAnimation)("mdc-linear-progress--indeterminate",i._isIndeterminate()))},inputs:{color:"color",value:[2,"value","value",et],bufferValue:[2,"bufferValue","bufferValue",et],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],features:[Ce],decls:7,vars:5,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(t,i){t&1&&(r(0,"div",0),b(1,"div",1),_(2,Ri,1,0,"div",2),o(),r(3,"div",3),b(4,"span",4),o(),r(5,"div",5),b(6,"span",4),o()),t&2&&(s(),Ge("flex-basis",i._getBufferBarFlexBasis()),s(),y(i.mode==="buffer"?2:-1),s(),Ge("transform",i._getPrimaryBarTransform()))},styles:[`.mat-mdc-progress-bar{display:block;text-align:start}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:max(var(--mdc-linear-progress-track-height, 4px),var(--mdc-linear-progress-active-indicator-height, 4px))}@media(forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);height:var(--mdc-linear-progress-active-indicator-height, 4px)}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}[dir=rtl] .mdc-linear-progress__bar{right:0;transform-origin:center right}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid;border-color:var(--mdc-linear-progress-active-indicator-color, var(--mat-sys-primary));border-top-width:var(--mdc-linear-progress-active-indicator-height, 4px)}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden;height:var(--mdc-linear-progress-track-height, 4px);border-radius:var(--mdc-linear-progress-track-shape, var(--mat-sys-corner-none))}.mdc-linear-progress__buffer-dots{-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");background-repeat:repeat-x;flex:auto;transform:rotate(180deg);animation:mdc-linear-progress-buffering 250ms infinite linear;background-color:var(--mdc-linear-progress-track-color, var(--mat-sys-surface-variant))}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}[dir=rtl] .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1);background-color:var(--mdc-linear-progress-track-color, var(--mat-sys-surface-variant))}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height, 4px) * -2.5))}}@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(83.67142%)}100%{transform:translateX(200.611057%)}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(84.386165%)}100%{transform:translateX(160.277782%)}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(-83.67142%)}100%{transform:translateX(-200.611057%)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(-37.651913%)}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(-84.386165%)}100%{transform:translateX(-160.277782%)}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}`],encapsulation:2,changeDetection:0})}return n})();function Ci(n,l=0,e=100){return Math.max(l,Math.min(e,n))}var xi=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=be({type:n});static \u0275inj=_e({imports:[yt]})}return n})();var zi=["*"];function Ki(n,l){n&1&&b(0,"div",0)}function Bi(n,l){if(n&1&&b(0,"mat-spinner",2),n&2){let e=p(2);d("color",e.color)("strokeWidth",e.strokeWidth)("diameter",e.diameter)("mode",e.mode)("value",e.value)}}function Ni(n,l){if(n&1&&b(0,"mat-progress-bar",3),n&2){let e=p(2);d("color",e.color)("mode",e.mode)("value",e.value)("bufferValue",e.bufferValue)}}function ji(n,l){if(n&1&&(r(0,"div",1),_(1,Bi,1,5,"mat-spinner",2)(2,Ni,1,4,"mat-progress-bar",3),o()),n&2){let e=p();s(),y(e.type==="spinner"?1:-1),s(),y(e.type==="progressbar"?2:-1)}}var Gi=(()=>{class n{constructor(){this._changeDetectorRef=g(Q),this.type="spinner",this.color="primary",this.mode="indeterminate",this.strokeWidth=4,this.diameter=48,this.bufferValue=0,this.value=0,this.loading=!0,this.hasBackdrop=!0}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["mtx-loader"]],hostAttrs:[1,"mtx-loader"],hostVars:2,hostBindings:function(t,i){t&2&&Z("mtx-loader-loading",i.loading)},inputs:{type:"type",color:"color",mode:"mode",strokeWidth:"strokeWidth",diameter:"diameter",bufferValue:"bufferValue",value:"value",loading:[2,"loading","loading",Je],hasBackdrop:[2,"hasBackdrop","hasBackdrop",Je]},exportAs:["mtxLoader"],features:[Ce],ngContentSelectors:zi,decls:3,vars:2,consts:[[1,"mtx-loader-backdrop"],[1,"mtx-loader-main"],[3,"color","strokeWidth","diameter","mode","value"],[3,"color","mode","value","bufferValue"]],template:function(t,i){t&1&&(_t(),_(0,Ki,1,0,"div",0)(1,ji,3,2,"div",1),ht(2)),t&2&&(y(i.loading&&i.hasBackdrop?0:-1),s(),y(i.loading?1:-1))},dependencies:[ze,Pi],styles:[`.mtx-loader{position:relative;display:block;width:100%;height:100%}.mtx-loader-main{position:absolute;top:0;left:0;z-index:210;display:flex;justify-content:center;align-items:center;width:100%;height:100%}.mtx-loader-main .mat-mdc-spinner{position:relative}.mtx-loader-main .mat-mdc-progress-bar{position:absolute;top:0;left:0;width:100%}.mtx-loader-backdrop{position:absolute;top:0;left:0;z-index:200;display:block;width:100%;height:100%;content:"";background-color:var(--mtx-loader-backdrop-background-color, color-mix(in srgb, var(--mat-sys-surface) 75%, transparent))}
`],encapsulation:2,changeDetection:0})}}return n})(),wi=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=be({type:n})}static{this.\u0275inj=_e({imports:[L,Ke,xi,Gi]})}}return n})();function Xi(n,l){n&1&&(r(0,"mtx-alert",15),m(1,"Nenhuma chave v\xE1lida encontrada."),o())}function qi(n,l){n&1&&(r(0,"mtx-alert",16),m(1," Autenticando no provedor selecionado... "),o())}function Zi(n,l){n&1&&(r(0,"mat-icon",17),m(1,"close"),o())}function Wi(n,l){if(n&1&&(r(0,"mat-error"),m(1),o()),n&2){let e=p();s(),h(e.getAIKeyErrorMessage("openaiApiKey"))}}function Qi(n,l){n&1&&(r(0,"mat-icon",17),m(1,"close"),o())}function Yi(n,l){if(n&1&&(r(0,"mat-error"),m(1),o()),n&2){let e=p();s(),h(e.getAIKeyErrorMessage("geminiApiKey"))}}var Mi=(()=>{class n{constructor(){this.fb=g(Te),this.settingsService=g(oe),this.http=g(D),this.auth=g(F),this.storage=g(Re),this.userId=null,this.llmKeys={},this.hasValidGemini=!1,this.hasValidOpenAI=!1,this.isLoginLoading=!1,this.showGeminiKey=!1,this.showOpenAIKey=!1,this.messageHandler=e=>this.onPopupMessage(e),this.oauthPopup=null}ngOnInit(){this.aiForm=this.fb.group({openaiApiKey:this.fb.control("",{nonNullable:!0}),geminiApiKey:this.fb.control("",{nonNullable:!0})});let e=this.aiForm.get("geminiApiKey"),t=this.aiForm.get("openaiApiKey");e?.setValidators([O.minLength(20),O.pattern(/^AIza[0-9A-Za-z-_]{20,40}$/)]),t?.setValidators([O.minLength(20),O.pattern(/^sk-[A-Za-z0-9-]{20,}$/)]),this.aiForm.patchValue({openaiApiKey:"",geminiApiKey:""});let i=this.auth.getCurrentUserValue?.()??null;this.userId=(i&&i.id)??null,window.addEventListener("message",this.messageHandler),this.fetchLlmKeys()}ngOnDestroy(){window.removeEventListener("message",this.messageHandler)}getAIKeyErrorMessage(e){let t=this.aiForm.get(e),i=t?.value||"";return typeof i=="string"&&i.includes("...")||!t||!t.touched?"":t.hasError("required")?"API key \xE9 obrigat\xF3ria.":t.hasError("minlength")?"Deve ter no m\xEDnimo 20 caracteres.":t.hasError("pattern")?"Formato de API key inv\xE1lido.":""}onSubmit(){if(this.aiForm.markAllAsTouched(),this.aiForm.invalid)return;let e=this.aiForm.get("openaiApiKey")?.value?.trim()||"",t=this.aiForm.get("geminiApiKey")?.value?.trim()||"",i=[];if(this.userId&&e&&/^sk-[A-Za-z0-9-]{20,}$/.test(e)){let f={provider:"openai",apiKey:e};this.llmKeys.openai?i.push(this.http.put(`/api/usuarios/${this.userId}/llm/keys`,f)):i.push(this.http.post(`/api/usuarios/${this.userId}/llm/keys`,f))}if(this.userId&&t&&/^AIza[0-9A-Za-z-_]{20,40}$/.test(t)){let f={provider:"gemini",apiKey:t};this.llmKeys.gemini?i.push(this.http.put(`/api/usuarios/${this.userId}/llm/keys`,f)):i.push(this.http.post(`/api/usuarios/${this.userId}/llm/keys`,f))}if(i.length===0){alert("Preencha ao menos uma chave v\xE1lida para salvar.");return}let a=()=>{e&&this.storage.set("ai.key.openai",e),t&&this.storage.set("ai.key.gemini",t)},c=()=>this.aiForm.patchValue({openaiApiKey:"",geminiApiKey:""}),u=()=>{a(),c(),this.fetchLlmKeys(),alert("Chaves de AI atualizadas com sucesso.")},v=f=>{a(),this.fetchLlmKeys(),alert(f||"Falha ao salvar no servidor. As chaves foram armazenadas localmente para uso tempor\xE1rio.")};i.length===1?i[0].subscribe({next:()=>u(),error:f=>{let T=typeof f?.error=="string"?f.error:f?.message||"Falha ao salvar no servidor.";v(T)}}):i[0].pipe(me(()=>i[1])).subscribe({next:()=>u(),error:f=>{let T=typeof f?.error=="string"?f.error:f?.message||"Falha ao salvar no servidor.";v(T)}})}toggleKeyVisibility(e){e==="gemini"?this.showGeminiKey=!this.showGeminiKey:this.showOpenAIKey=!this.showOpenAIKey}openGeminiPortal(){window.open("https://ai.google.dev/gemini-api/docs/api-key","_blank")}openOpenAIPortal(){window.open("https://platform.openai.com/settings/organization/api-keys","_blank")}fetchLlmKeys(){if(!this.userId){let e=this.storage.get("ai.key.openai")??this.storage.get("ai.openaiKey"),t=this.storage.get("ai.key.gemini")??this.storage.get("ai.geminiKey");this.hasValidOpenAI=!!e&&/^sk-[A-Za-z0-9-]{20,}$/.test(e),this.hasValidGemini=!!t&&/^AIza[0-9A-Za-z-_]{20,40}$/.test(t),this.aiForm.patchValue({openaiApiKey:e||"",geminiApiKey:t||""});return}this.http.get(`/api/usuarios/${this.userId}/llm/keys`).pipe(le(()=>X(null))).subscribe(e=>{let t=e||{},i=t?.gemini,a=t?.openai,c=t?.geminiKeyMasked,u=t?.openaiKeyMasked,v=this.storage.get("ai.key.openai")??this.storage.get("ai.openaiKey"),f=this.storage.get("ai.key.gemini")??this.storage.get("ai.geminiKey"),T=!!v&&/^sk-[A-Za-z0-9-]{20,}$/.test(v),Be=!!f&&/^AIza[0-9A-Za-z-_]{20,40}$/.test(f),Ne=typeof i=="boolean"?i:this.validateKey("gemini",i||""),je=typeof a=="boolean"?a:this.validateKey("openai",a||"");this.llmKeys={gemini:Ne||Be,openai:je||T},this.hasValidGemini=this.llmKeys.gemini||!1,this.hasValidOpenAI=this.llmKeys.openai||!1;let ce=typeof u=="string"&&u?u:typeof a=="string"?a:v||"",de=typeof c=="string"&&c?c:typeof i=="string"?i:f||"";this.aiForm.patchValue({openaiApiKey:ce,geminiApiKey:de});let H=this.aiForm.get("openaiApiKey"),pe=this.aiForm.get("geminiApiKey"),rt=at=>typeof at=="string"&&at.includes("...");H&&(rt(ce)?H.clearValidators():H.setValidators([O.minLength(20),O.pattern(/^sk-[A-Za-z0-9-]{20,}$/)]),H.updateValueAndValidity()),pe&&(rt(de)?pe.clearValidators():pe.setValidators([O.minLength(20),O.pattern(/^AIza[0-9A-Za-z-_]{20,40}$/)]),pe.updateValueAndValidity())})}validateKey(e,t){return!t||typeof t!="string"?!1:t.includes("...")?!0:e==="gemini"?/^AIza[0-9A-Za-z-_]{20,40}$/.test(t):e==="openai"?/^sk-[A-Za-z0-9-]{20,}$/.test(t):!1}loginWithProvider(e){}onPopupMessage(e){try{let t=e.data||{};if(!t||t.type!=="llm-auth")return;this.isLoginLoading=!1}catch{this.isLoginLoading=!1}}isInvalid(e){let t=this.aiForm.get(e),i=t?.value||"";return typeof i=="string"&&i.includes("...")||e==="openaiApiKey"&&this.hasValidOpenAI||e==="geminiApiKey"&&this.hasValidGemini?!1:!!i&&!!t?.invalid}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-ai-settings"]],features:[Pe([oe])],decls:41,vars:35,consts:[[1,"form-field-full",3,"ngSubmit","formGroup"],[1,"row","form-grid-row"],[1,"col-12"],[1,"status-container","m-b-8"],["color","primary","aria-readonly","true",1,"status-toggle",3,"checked","disabled","tabindex"],["type","warning","class","m-b-8",4,"ngIf"],["type","info","class","m-b-8",4,"ngIf"],["appearance","outline",1,"w-100"],["matInput","","placeholder","sk-...","formControlName","openaiApiKey",3,"type"],["mat-icon-button","","matSuffix","","type","button",3,"click"],["matSuffix","","color","warn",4,"ngIf"],["appearance","outline"],["matInput","","formControlName","geminiApiKey",3,"type","placeholder"],[1,"save-button-container","m-t-16"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["type","warning",1,"m-b-8"],["type","info",1,"m-b-8"],["matSuffix","","color","warn"]],template:function(t,i){if(t&1&&(r(0,"mat-card")(1,"mat-card-content")(2,"form",0),C("ngSubmit",function(){return i.onSubmit()}),r(3,"div",1)(4,"div",2)(5,"div",3)(6,"mat-slide-toggle",4),m(7),o(),r(8,"mat-slide-toggle",4),m(9),o()(),_(10,Xi,2,0,"mtx-alert",5)(11,qi,2,0,"mtx-alert",6),o(),r(12,"div",2)(13,"h4"),m(14,"API Keys (Integra\xE7\xF5es LLM)"),o()(),r(15,"div",2)(16,"mat-form-field",7)(17,"mat-label"),m(18,"OpenAI API Key"),o(),b(19,"input",8),r(20,"button",9),C("click",function(){return i.toggleKeyVisibility("openai")}),r(21,"mat-icon"),m(22),o()(),_(23,Zi,2,0,"mat-icon",10)(24,Wi,2,1,"mat-error"),o()(),r(25,"div",2)(26,"mat-form-field",11)(27,"mat-label"),m(28),P(29,"translate"),o(),b(30,"input",12),P(31,"translate"),r(32,"button",9),C("click",function(){return i.toggleKeyVisibility("gemini")}),r(33,"mat-icon"),m(34),o()(),_(35,Qi,2,0,"mat-icon",10)(36,Yi,2,1,"mat-error"),o()()(),r(37,"div",13)(38,"button",14),m(39),P(40,"translate"),o()()()()()),t&2){let a,c;s(2),d("formGroup",i.aiForm),s(4),d("checked",i.hasValidOpenAI)("disabled",!0)("tabindex",-1),s(),U(" OpenAI ",i.hasValidOpenAI?"dispon\xEDvel":"indispon\xEDvel"," "),s(),d("checked",i.hasValidGemini)("disabled",!0)("tabindex",-1),s(),U(" Gemini ",i.hasValidGemini?"dispon\xEDvel":"indispon\xEDvel"," "),s(),d("ngIf",!i.hasValidGemini&&!i.hasValidOpenAI),s(),d("ngIf",i.isLoginLoading),s(5),Z("invalid-field",i.isInvalid("openaiApiKey")),s(3),d("type",i.showOpenAIKey?"text":"password"),s(),V("aria-label",i.showOpenAIKey?"Ocultar chave":"Exibir chave"),s(2),h(i.showOpenAIKey?"visibility_off":"visibility"),s(),d("ngIf",i.isInvalid("openaiApiKey")),s(),y((a=i.aiForm.get("openaiApiKey"))!=null&&a.invalid&&((a=i.aiForm.get("openaiApiKey"))!=null&&a.touched)?24:-1),s(2),Z("invalid-field",i.isInvalid("geminiApiKey")),s(2),h(x(29,29,"settings.ai.gemini_api_key")),s(2),d("type",i.showGeminiKey?"text":"password")("placeholder",x(31,31,"settings.ai.placeholders.gemini_api_key")),s(2),V("aria-label",i.showGeminiKey?"Ocultar chave":"Exibir chave"),s(2),h(i.showGeminiKey?"visibility_off":"visibility"),s(),d("ngIf",i.isInvalid("geminiApiKey")),s(),y((c=i.aiForm.get("geminiApiKey"))!=null&&c.invalid&&((c=i.aiForm.get("geminiApiKey"))!=null&&c.touched)?36:-1),s(2),d("disabled",i.aiForm.invalid),s(),U(" ",x(40,33,"common.save")," ")}},dependencies:[L,we,De,Ie,Se,Ae,Ee,Fe,ke,Ue,z,R,$,ie,te,J,Oe,ee,re,ne,Ve,K,ye,Y,G,j,$t,Rt,N,B,mi,li,wi,gi],styles:[".save-button-container[_ngcontent-%COMP%]{display:flex;justify-content:center}mat-card[_ngcontent-%COMP%], .mat-mdc-card[_ngcontent-%COMP%], .mdc-card[_ngcontent-%COMP%], .mat-mdc-card-outlined[_ngcontent-%COMP%], .mdc-card--outlined[_ngcontent-%COMP%]{background:transparent!important;border:none!important;box-shadow:none!important}mat-card-content[_ngcontent-%COMP%], .mat-mdc-card-content[_ngcontent-%COMP%]{background:transparent!important;padding:12px 16px}.invalid-field[_ngcontent-%COMP%]   .mdc-notched-outline__leading[_ngcontent-%COMP%], .invalid-field[_ngcontent-%COMP%]   .mdc-notched-outline__trailing[_ngcontent-%COMP%], .invalid-field[_ngcontent-%COMP%]   .mdc-notched-outline__notch[_ngcontent-%COMP%]{border-color:var(--mat-sys-error)!important}.status-container[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center;padding:12px 0}.status-toggle[_ngcontent-%COMP%]{pointer-events:none;-webkit-user-select:none;user-select:none}.form-grid-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{margin-bottom:14px;width:100%}.save-button-container[_ngcontent-%COMP%]{margin-top:16px}.form-grid-row[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px}.form-grid-row[_ngcontent-%COMP%]   .mat-mdc-form-field-infix[_ngcontent-%COMP%]{padding:10px 0}"]})}}return n})();var Ji=()=>[5];function en(n,l){n&1&&(r(0,"th",31),m(1,"ID"),o())}function tn(n,l){if(n&1&&(r(0,"td",32),m(1),o()),n&2){let e=l.$implicit;s(),h(e.id)}}function nn(n,l){n&1&&(r(0,"th",31),m(1,"Username"),o())}function rn(n,l){if(n&1){let e=S();r(0,"input",35),C("input",function(i){w(e);let a=p(3);return M(a.onEditField("username",i.target.value))}),o()}if(n&2){let e,t=p(3);d("value",(e=t.editingUser==null?null:t.editingUser.username)!==null&&e!==void 0?e:"")}}function an(n,l){if(n&1&&(r(0,"span"),m(1),o()),n&2){let e=p().$implicit;s(),h(e.username)}}function on(n,l){if(n&1&&(r(0,"td",32),_(1,rn,1,1,"input",33)(2,an,2,1,"span",34),o()),n&2){let e=l.$implicit,t=p(2);s(),d("ngIf",(t.editingUser==null?null:t.editingUser.id)===e.id),s(),d("ngIf",(t.editingUser==null?null:t.editingUser.id)!==e.id)}}function sn(n,l){n&1&&(r(0,"th",31),m(1,"Email"),o())}function ln(n,l){if(n&1){let e=S();r(0,"input",35),C("input",function(i){w(e);let a=p(3);return M(a.onEditField("email",i.target.value))}),o()}if(n&2){let e,t=p(3);d("value",(e=t.editingUser==null?null:t.editingUser.email)!==null&&e!==void 0?e:"")}}function mn(n,l){if(n&1&&(r(0,"span"),m(1),o()),n&2){let e=p().$implicit;s(),h(e.email)}}function cn(n,l){if(n&1&&(r(0,"td",32),_(1,ln,1,1,"input",33)(2,mn,2,1,"span",34),o()),n&2){let e=l.$implicit,t=p(2);s(),d("ngIf",(t.editingUser==null?null:t.editingUser.id)===e.id),s(),d("ngIf",(t.editingUser==null?null:t.editingUser.id)!==e.id)}}function dn(n,l){n&1&&(r(0,"th",31),m(1,"Roles"),o())}function pn(n,l){if(n&1&&(r(0,"td",32),m(1),o()),n&2){let e=l.$implicit,t=p(2);s(),h(t.formatRoles(e.roles))}}function un(n,l){n&1&&(r(0,"th",31),m(1,"\xDAltimo login"),o())}function gn(n,l){if(n&1&&(r(0,"td",32),m(1),P(2,"date"),o()),n&2){let e=l.$implicit;s(),h(e.lastLogin?xe(2,1,e.lastLogin,"dd/MM/yyyy HH:mm"):"\u2014")}}function fn(n,l){n&1&&(r(0,"th",31),m(1,"Data de cadastro"),o())}function _n(n,l){if(n&1&&(r(0,"td",32),m(1),P(2,"date"),o()),n&2){let e=l.$implicit;s(),h(e.createdAt?xe(2,1,e.createdAt,"dd/MM/yyyy HH:mm"):"\u2014")}}function hn(n,l){n&1&&(r(0,"th",31),m(1,"Premium expira"),o())}function vn(n,l){if(n&1&&(I(0),m(1),P(2,"date"),k()),n&2){let e=p().$implicit;s(),U(" ",e.premiumUntil?xe(2,1,e.premiumUntil,"dd/MM/yyyy"):"\u2014"," ")}}function bn(n,l){if(n&1){let e=S();r(0,"div",37)(1,"mat-form-field",38)(2,"input",39),C("dateChange",function(i){w(e);let a=p(3);return M(a.premiumUntilInput=i.value)}),o(),b(3,"mat-datepicker-toggle",40)(4,"mat-datepicker",null,1),o(),r(6,"div",41)(7,"button",42),C("click",function(){w(e);let i=p().$implicit,a=p(2);return M(a.confirmActivatePremium(i))}),r(8,"mat-icon"),m(9,"save"),o()(),r(10,"button",43),C("click",function(){w(e);let i=p(3);return M(i.cancelActivatePremium())}),r(11,"mat-icon"),m(12,"close"),o()()()()}if(n&2){let e=W(5),t=p(3);s(2),d("matDatepicker",e)("value",t.premiumUntilInput),s(),d("for",e)}}function Cn(n,l){if(n&1&&(r(0,"td",32),_(1,vn,3,4,"ng-container",36)(2,bn,13,3,"ng-template",null,0,Ye),o()),n&2){let e=l.$implicit,t=W(3),i=p(2);s(),d("ngIf",i.premiumActivationId!==e.id)("ngIfElse",t)}}function Pn(n,l){n&1&&(r(0,"th",44),m(1,"Premium"),o())}function xn(n,l){if(n&1){let e=S();I(0),r(1,"div",45)(2,"button",46),C("click",function(){w(e);let i=p().$implicit,a=p(2);return M(a.startActivatePremium(i))}),r(3,"mat-icon"),m(4,"verified"),o()(),r(5,"button",47),C("click",function(){w(e);let i=p().$implicit,a=p(2);return M(a.deactivatePremium(i))}),r(6,"mat-icon"),m(7,"block"),o()()(),k()}}function wn(n,l){}function Mn(n,l){if(n&1&&(r(0,"td",32),_(1,xn,8,0,"ng-container",36)(2,wn,0,0,"ng-template",null,2,Ye),o()),n&2){let e=l.$implicit,t=W(3),i=p(2);s(),d("ngIf",i.premiumActivationId!==e.id)("ngIfElse",t)}}function yn(n,l){n&1&&(r(0,"th",44),m(1,"A\xE7\xF5es"),o())}function On(n,l){if(n&1){let e=S();r(0,"button",53),C("click",function(){w(e);let i=p().$implicit,a=p(2);return M(a.startEdit(i))}),r(1,"mat-icon"),m(2,"edit"),o()()}}function Sn(n,l){if(n&1){let e=S();r(0,"button",54),C("click",function(){w(e);let i=p(3);return M(i.saveEdit())}),r(1,"mat-icon"),m(2,"save"),o()()}}function An(n,l){if(n&1){let e=S();r(0,"button",55),C("click",function(){w(e);let i=p(3);return M(i.cancelEdit())}),r(1,"mat-icon"),m(2,"close"),o()()}}function En(n,l){if(n&1){let e=S();r(0,"button",56),C("click",function(){w(e);let i=p().$implicit,a=p(2);return M(a.deleteUser(i))}),r(1,"mat-icon"),m(2,"delete"),o()()}}function In(n,l){if(n&1){let e=S();r(0,"td",32),_(1,On,3,0,"button",48)(2,Sn,3,0,"button",49)(3,An,3,0,"button",50),r(4,"button",51),C("click",function(){let i=w(e).$implicit,a=p(2);return M(a.resetPassword(i))}),r(5,"mat-icon"),m(6,"vpn_key"),o()(),_(7,En,3,0,"button",52),o()}if(n&2){let e=l.$implicit,t=p(2);s(),d("ngIf",(t.editingUser==null?null:t.editingUser.id)!==e.id),s(),d("ngIf",(t.editingUser==null?null:t.editingUser.id)===e.id),s(),d("ngIf",(t.editingUser==null?null:t.editingUser.id)===e.id),s(4),d("ngIf",(t.editingUser==null?null:t.editingUser.id)!==e.id)}}function kn(n,l){n&1&&b(0,"tr",57)}function Un(n,l){n&1&&b(0,"tr",58)}function Tn(n,l){if(n&1){let e=S();r(0,"mat-tab",9)(1,"div",6)(2,"mat-card",10)(3,"mat-card-content")(4,"div",11)(5,"mat-form-field",12)(6,"mat-label"),m(7,"Buscar usu\xE1rios"),o(),r(8,"input",13),C("keyup",function(i){w(e);let a=p();return M(a.applyFilter(i.target.value))}),o()()(),r(9,"div",14)(10,"table",15),I(11,16),_(12,en,2,0,"th",17)(13,tn,2,1,"td",18),k(),I(14,19),_(15,nn,2,0,"th",17)(16,on,3,2,"td",18),k(),I(17,20),_(18,sn,2,0,"th",17)(19,cn,3,2,"td",18),k(),I(20,21),_(21,dn,2,0,"th",17)(22,pn,2,1,"td",18),k(),I(23,22),_(24,un,2,0,"th",17)(25,gn,3,4,"td",18),k(),I(26,23),_(27,fn,2,0,"th",17)(28,_n,3,4,"td",18),k(),I(29,24),_(30,hn,2,0,"th",17)(31,Cn,4,2,"td",18),k(),I(32,25),_(33,Pn,2,0,"th",26)(34,Mn,4,2,"td",18),k(),I(35,27),_(36,yn,2,0,"th",26)(37,In,8,4,"td",18),k(),_(38,kn,1,0,"tr",28)(39,Un,1,0,"tr",29),o()(),b(40,"mat-paginator",30),o()()()()}if(n&2){let e=p();s(8),d("value",e.searchValue),s(2),d("dataSource",e.usersDataSource),s(28),d("matHeaderRowDef",e.displayedColumns),s(),d("matRowDefColumns",e.displayedColumns),s(),d("pageSize",5)("pageSizeOptions",bt(6,Ji))}}var yi=(()=>{class n{constructor(){this.authService=g(F),this.platformId=g(ut),this.renderer=g(ve),this.settings=g(Ft),this.http=g(D),this.usersDataSource=new ai([]),this.displayedColumns=["id","username","email","roles","lastLogin","createdAt","premiumUntil","premium","actions"],this.editingUser=null,this.selectedUserId=null,this.searchValue="",this.pageSize=5,this.totalUsers=0,this.loadingUsers=!1,this.pageIndex=0,this.sortActive="",this.sortDirection="",this.premiumActivationId=null,this.premiumUntilInput=null}ngOnInit(){this.isAdmin&&(this.usersDataSource.filterPredicate=(e,t)=>{let i=(t||"").toLowerCase(),a=String(e?.id??"").toLowerCase(),c=String(e?.username??"").toLowerCase(),u=String(e?.email??"").toLowerCase(),v=Array.isArray(e?.roles)?e.roles.map(f=>String(typeof f=="string"?f:f?.name??f?.role??f?.id??"")).join(",").toLowerCase():String(e?.roles??"").toLowerCase();return a.includes(i)||c.includes(i)||u.includes(i)||v.includes(i)},this.loadAllUsers())}ngAfterViewInit(){this.isAdmin&&(this.usersDataSource.paginator=this.paginator,this.usersDataSource.sort=this.sort)}ngOnDestroy(){}get isAdmin(){let t=this.authService.getCurrentUserValue()?.roles;return!t||!Array.isArray(t)?!1:t.some(i=>{if(typeof i=="string")return i.toUpperCase()==="ADMIN";let a=i?.name||i?.role||i?.id||"";return String(a).toUpperCase()==="ADMIN"})}formatRoles(e){if(e==null)return"";if(Array.isArray(e))return e.map(t=>{let i=typeof t=="string"?t:t?.name??t?.role??t?.id??"";return String(i)}).filter(t=>t&&t.length>0).join(", ");if(typeof e=="string")return e;if(typeof e=="object"){let t=e?.name??e?.role??e?.id??"";return String(t)}return String(e)}startEdit(e){this.editingUser=se({},e)}cancelEdit(){this.editingUser=null}onEditField(e,t){this.editingUser&&(this.editingUser[e]=t)}saveEdit(){if(!this.editingUser||!this.editingUser.id)return;let e=this.editingUser.id,i=`${`${A.baseUrl||""}/api`}/usuarios/${e}`,a=new FormData;a.append("username",String(this.editingUser.username??"")),a.append("email",String(this.editingUser.email??"")),this.http.put(i,a).subscribe({next:c=>{let u=this.usersDataSource.data.map(v=>v.id===e?c:v);this.usersDataSource.data=u,this.editingUser=null},error:c=>{console.error("Erro ao atualizar usu\xE1rio",c)}})}activatePremium(e){if(!e?.id)return;let t=e.id,i=`${A.baseUrl||""}/api`;this.http.post(`${i}/usuarios/${t}/assinatura/premium/ativar`,{}).subscribe({next:()=>{this.isAdmin?this.loadAllUsers():this.loadCurrentUser()},error:a=>{console.error("Erro ao ativar premium",a)}})}deactivatePremium(e){if(!e?.id)return;let t=e.id,i=`${A.baseUrl||""}/api`;this.http.post(`${i}/usuarios/${t}/assinatura/premium/desativar`,{}).subscribe({next:()=>{this.isAdmin?this.loadAllUsers():this.loadCurrentUser()},error:a=>{console.error("Erro ao desativar premium",a)}})}startActivatePremium(e){this.premiumActivationId=e?.id??null,this.premiumUntilInput=e?.premiumUntil?new Date(e.premiumUntil):null}cancelActivatePremium(){this.premiumActivationId=null,this.premiumUntilInput=null}confirmActivatePremium(e){if(!e?.id)return;let t=e.id,i={};this.premiumUntilInput instanceof Date&&!isNaN(this.premiumUntilInput.getTime())&&(i.premiumUntil=this.premiumUntilInput.toISOString());let a=`${A.baseUrl||""}/api`;this.http.post(`${a}/usuarios/${t}/assinatura/premium/ativar`,i).subscribe({next:()=>{this.premiumActivationId=null,this.premiumUntilInput=null,i.premiumUntil&&(this.usersDataSource.data=this.usersDataSource.data.map(c=>c.id===t?ue(se({},c),{premiumUntil:new Date(i.premiumUntil)}):c)),this.isAdmin?this.loadAllUsers():this.loadCurrentUser()},error:c=>{console.error("Erro ao ativar premium",c)}})}normalizeUser(e){let t=u=>{if(u==null)return null;if(u instanceof Date)return isNaN(u.getTime())?null:u;if(typeof u=="number"){let v=u<1e12?u*1e3:u,f=new Date(v);return isNaN(f.getTime())?null:f}if(typeof u=="string"){if(/^\d{4}-\d{2}-\d{2}/.test(u)){let T=new Date(u);return isNaN(T.getTime())?null:T}let v=u.match(/^(\d{2})\/(\d{2})\/(\d{4})(?:\s+(\d{2}):(\d{2})(?::(\d{2}))?)?$/);if(v){let T=Number(v[1]),Be=Number(v[2])-1,Ne=Number(v[3]),je=Number(v[4]??0),ce=Number(v[5]??0),de=Number(v[6]??0),H=new Date(Ne,Be,T,je,ce,de);return isNaN(H.getTime())?null:H}let f=Number(u);return isNaN(f)?null:t(f)}return null},i=e?.createdAt??e?.created_at??e?.created??e?.dataCadastro??e?.data_cadastro??e?.dtCadastro??e?.registrationDate,a=e?.lastLogin??e?.last_login??e?.ultimoLogin??e?.ultimo_login,c=e?.premiumUntil??e?.premium_until;return ue(se({},e),{createdAt:t(i),lastLogin:t(a),premiumUntil:t(c)})}updatePremiumStatuses(e){let t=`${A.baseUrl||""}/api`;e.forEach(i=>{let a=i?.id;a!=null&&this.http.get(`${t}/usuarios/${a}/assinatura/premium/status`).subscribe({next:c=>{let u=c?.expiraEm?new Date(c.expiraEm):null;this.usersDataSource.data=this.usersDataSource.data.map(v=>v.id===a?ue(se({},v),{premiumUntil:u}):v)}})})}deleteUser(e){if(!e||!e.id)return;let t=e.id,i=`${A.baseUrl||""}/api`;this.http.delete(`${i}/usuarios/${t}`).subscribe({next:()=>{this.usersDataSource.data=this.usersDataSource.data.filter(a=>a.id!==t),this.totalUsers=this.usersDataSource.data.length},error:a=>{console.error("Erro ao excluir usu\xE1rio",a)}})}applyFilter(e){this.searchValue=e,this.usersDataSource.filter=(e||"").trim().toLowerCase()}loadCurrentUser(){this.loadingUsers=!0;let t=this.authService.getCurrentUserValue()?.id;if(t==null){this.usersDataSource.data=[],this.totalUsers=0,this.loadingUsers=!1;return}let i=`${A.baseUrl||""}/api`;this.http.get(`${i}/usuarios/${t}`).subscribe({next:a=>{let c=a?[this.normalizeUser(a)]:[];this.usersDataSource.data=c,this.totalUsers=this.usersDataSource.data.length,this.loadingUsers=!1,this.paginator&&(this.paginator.pageSize=this.pageSize,this.paginator.firstPage()),c.length&&this.updatePremiumStatuses(c)},error:()=>{this.usersDataSource.data=[],this.totalUsers=0,this.loadingUsers=!1}})}loadAllUsers(){this.loadingUsers=!0;let e=`${A.baseUrl||""}/api`;this.http.get(`${e}/usuarios`).subscribe({next:t=>{let i=Array.isArray(t)?t.map(a=>this.normalizeUser(a)):[];this.usersDataSource.data=i,this.totalUsers=this.usersDataSource.data.length,this.loadingUsers=!1,this.paginator&&(this.paginator.pageSize=this.pageSize,this.paginator.firstPage()),i.length&&this.updatePremiumStatuses(i)},error:()=>{this.usersDataSource.data=[],this.totalUsers=0,this.loadingUsers=!1}})}resetPassword(e){if(!e?.id)return;let t=`${A.baseUrl||""}/api`;this.http.post(`${t}/usuarios/resetar-senha`,{id:e.id}).subscribe({next:()=>{console.log("Senha resetada para usu\xE1rio",e.id)},error:i=>{console.error("Erro ao resetar senha",i)}})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=E({type:n,selectors:[["app-profile-overview"]],viewQuery:function(t,i){if(t&1&&(Ze(Le,5),Ze($e,5)),t&2){let a;We(a=Qe())&&(i.paginator=a.first),We(a=Qe())&&(i.sort=a.first)}},decls:10,vars:4,consts:[["premiumUntilEditTpl",""],["pickerPremiumUntil",""],["premiumEditingTpl",""],[1,"profile-overview"],["dynamicHeight","",1,"futuristic-tabs"],[3,"label"],[1,"tab-content"],["label","AI Settings"],["label","Administrador",4,"ngIf"],["label","Administrador"],[1,"table-card"],[1,"admin-controls","d-flex","align-items-center"],["appearance","outline",1,"user-search-field"],["matInput","","placeholder","Nome, e-mail, ID, role",3,"keyup","value"],[1,"user-table-wrapper"],["mat-table","","matSort","",1,"mat-elevation-z1","w-100","user-table",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","username"],["matColumnDef","email"],["matColumnDef","roles"],["matColumnDef","lastLogin"],["matColumnDef","createdAt"],["matColumnDef","premiumUntil"],["matColumnDef","premium"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",1,"m-t-8",3,"pageSize","pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["matInput","",3,"value","input",4,"ngIf"],[4,"ngIf"],["matInput","",3,"input","value"],[4,"ngIf","ngIfElse"],[1,"premium-until-edit"],["appearance","outline",1,"premium-until-field"],["matInput","",3,"dateChange","matDatepicker","value"],["matSuffix","",3,"for"],[1,"premium-until-actions"],["mat-icon-button","","color","primary","matTooltip","Salvar","aria-label","Salvar",3,"click"],["mat-icon-button","","matTooltip","Cancelar","aria-label","Cancelar",3,"click"],["mat-header-cell",""],[1,"premium-actions"],["mat-icon-button","","color","primary","matTooltip","Ativar Premium","aria-label","Ativar Premium",3,"click"],["mat-icon-button","","color","warn","matTooltip","Desativar Premium","aria-label","Desativar Premium",3,"click"],["mat-icon-button","","color","primary","aria-label","Editar",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","aria-label","Salvar",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Cancelar",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Resetar senha","aria-label","Resetar senha",3,"click"],["mat-icon-button","","color","warn","aria-label","Excluir",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","aria-label","Editar",3,"click"],["mat-icon-button","","color","primary","aria-label","Salvar",3,"click"],["mat-icon-button","","aria-label","Cancelar",3,"click"],["mat-icon-button","","color","warn","aria-label","Excluir",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(t,i){t&1&&(r(0,"div",3)(1,"mat-tab-group",4)(2,"mat-tab",5),P(3,"translate"),r(4,"div",6),b(5,"app-profile-settings"),o()(),r(6,"mat-tab",7)(7,"div",6),b(8,"app-ai-settings"),o()(),_(9,Tn,41,7,"mat-tab",8),o()()),t&2&&(s(2),d("label",x(3,2,"edit_profile")),s(7),d("ngIf",i.isAdmin))},dependencies:[L,we,Ct,z,R,$,Xt,Gt,Ht,G,j,K,Y,Ut,kt,bi,Mi,N,B,ri,qt,Wt,ei,Qt,Zt,ti,Yt,Jt,ii,ni,Tt,Le,si,$e,oi,ie,te,J,ee,re,ne,ui,ci,di,pi,At],styles:["[_nghost-%COMP%]{display:block}.tab-content[_ngcontent-%COMP%]{padding:var(--gutter)}.tradingview-widget-container__widget[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:var(--mat-sys-corner-medium);background:transparent!important}button[mat-icon-button][_ngcontent-%COMP%]   mat-icon.spin-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.profile-overview[_ngcontent-%COMP%]{padding:var(--gutter);border:1px solid var(--mat-sys-outline);border-radius:var(--mat-sys-corner-medium);background:transparent}.theme-dark[_ngcontent-%COMP%]   .profile-overview[_ngcontent-%COMP%]{background-color:#0f0f0f!important}.profile-overview[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   mat-card.mat-mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .mat-mdc-card.mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .mat-mdc-card-outlined[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .mdc-card--outlined[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%]{background-color:transparent!important;border-radius:var(--mat-sys-corner-medium)!important;box-shadow:none!important}.profile-overview[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{background:transparent!important}.profile-overview[_ngcontent-%COMP%]   app-profile-settings[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-profile-settings[_ngcontent-%COMP%]   mat-card.mat-mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-profile-settings[_ngcontent-%COMP%]   .mat-mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-profile-settings[_ngcontent-%COMP%]   .mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-profile-settings[_ngcontent-%COMP%]   .mat-mdc-card-outlined[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-profile-settings[_ngcontent-%COMP%]   .mdc-card--outlined[_ngcontent-%COMP%]{background:transparent!important;border:none!important;box-shadow:none!important}.profile-overview[_ngcontent-%COMP%]   app-ai-settings[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-ai-settings[_ngcontent-%COMP%]   mat-card.mat-mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-ai-settings[_ngcontent-%COMP%]   .mat-mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-ai-settings[_ngcontent-%COMP%]   .mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-ai-settings[_ngcontent-%COMP%]   .mat-mdc-card-outlined[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   app-ai-settings[_ngcontent-%COMP%]   .mdc-card--outlined[_ngcontent-%COMP%]{background:transparent!important;border:none!important;box-shadow:none!important}.profile-overview[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{background:transparent!important}.profile-overview[_ngcontent-%COMP%]   .chart-card[_ngcontent-%COMP%]{width:100%}.profile-overview[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .table-card.mat-mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .table-card.mdc-card[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .table-card.mat-mdc-card-outlined[_ngcontent-%COMP%], .profile-overview[_ngcontent-%COMP%]   .table-card.mdc-card--outlined[_ngcontent-%COMP%]{background:transparent!important;border:none!important;box-shadow:none!important}.tradingview-widget-container[_ngcontent-%COMP%]{width:100%;height:450px;overflow:hidden;background:transparent}.tradingview-widget-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{background:transparent!important;width:100%!important;max-width:100%!important;display:block!important}.tradingview-widget-container[_ngcontent-%COMP%], .tradingview-widget-container__widget[_ngcontent-%COMP%]{width:100%!important;max-width:100%!important;display:block!important;box-sizing:border-box}.theme-dark[_ngcontent-%COMP%]   .profile-overview[_ngcontent-%COMP%]   .tradingview-widget-container[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .profile-overview[_ngcontent-%COMP%]   .tradingview-widget-container__widget[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]   .profile-overview[_ngcontent-%COMP%]   .tradingview-widget-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{background:transparent!important}.spin-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.admin-controls[_ngcontent-%COMP%]{gap:12px;margin-bottom:12px}.user-search-field[_ngcontent-%COMP%]{width:100%;max-width:320px}.premium-inputs[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-start;flex-wrap:wrap}.premium-date-field[_ngcontent-%COMP%]{width:100%;min-width:200px;max-width:280px;flex:1 1 240px}.premium-until-edit[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:flex-start;flex-wrap:wrap}.premium-until-field[_ngcontent-%COMP%]{width:100%;min-width:240px;max-width:320px;flex:1 1 260px}.premium-until-actions[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.premium-actions[_ngcontent-%COMP%]{display:flex;gap:6px;align-items:center}.news-actions[_ngcontent-%COMP%]{margin-top:8px}.futuristic-tabs[_ngcontent-%COMP%]   .mat-tab-labels[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}.futuristic-tabs[_ngcontent-%COMP%]   .mat-tab-label[_ngcontent-%COMP%]{min-width:unset;padding:8px 12px;font-size:.9rem;font-weight:500;color:var(--mat-sys-on-surface-variant);transition:color .3s ease}.futuristic-tabs[_ngcontent-%COMP%]   .mat-tab-label[_ngcontent-%COMP%]:hover{color:var(--mat-sys-primary)}.futuristic-tabs[_ngcontent-%COMP%]   .mat-tab-label.mat-tab-label-active[_ngcontent-%COMP%]{font-weight:600;color:var(--mat-sys-primary)}.futuristic-tabs[_ngcontent-%COMP%]   .mat-tab-header[_ngcontent-%COMP%]{margin-bottom:12px;border-bottom:2px solid var(--mat-sys-outline)}.futuristic-tabs[_ngcontent-%COMP%]   .mat-ink-bar[_ngcontent-%COMP%]{height:3px;background-color:var(--mat-sys-primary);border-radius:2px}table.mat-mdc-table[_ngcontent-%COMP%]{width:100%}.user-table-wrapper[_ngcontent-%COMP%]{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}.user-table[_ngcontent-%COMP%]{table-layout:fixed}.user-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%], .user-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{padding:8px 12px;font-size:.78rem;line-height:1.35;word-break:break-word;overflow-wrap:anywhere}.user-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]{height:auto}.user-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{align-items:flex-start;overflow:visible}.mat-column-premium[_ngcontent-%COMP%]{min-width:240px}.mat-column-premiumUntil[_ngcontent-%COMP%]{min-width:280px}.mat-column-username[_ngcontent-%COMP%]{min-width:120px}.mat-column-email[_ngcontent-%COMP%]{min-width:200px}.mat-column-roles[_ngcontent-%COMP%], .mat-column-lastLogin[_ngcontent-%COMP%], .mat-column-createdAt[_ngcontent-%COMP%]{min-width:160px}.mat-column-premiumUntil[_ngcontent-%COMP%]{min-width:220px}.mat-column-actions[_ngcontent-%COMP%]{width:140px}@media (width <= 900px){.user-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%], .user-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{padding:6px 10px;font-size:.76rem}.mat-column-email[_ngcontent-%COMP%]{min-width:180px}.mat-column-roles[_ngcontent-%COMP%]{min-width:140px}}@media (width <= 600px){.premium-until-edit[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.user-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%], .user-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{padding:5px 8px;font-size:.74rem}.mat-column-email[_ngcontent-%COMP%]{min-width:160px}.mat-column-roles[_ngcontent-%COMP%]{min-width:120px}.mat-column-actions[_ngcontent-%COMP%]{width:128px}}"]})}}return n})();var Ya=[{path:"",component:fi,children:[{path:"",redirectTo:"overview",pathMatch:"full"},{path:"overview",component:yi}]}];export{Ya as routes};
