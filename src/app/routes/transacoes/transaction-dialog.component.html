<div class="dialog-container">
  <h2 mat-dialog-title class="dialog-title">Nova Transação</h2>
  <mat-dialog-content class="dialog-content">
    <mat-horizontal-stepper [linear]="true" #stepper class="transaction-stepper">

      <mat-step [stepControl]="formGroupStep1" >
        <form [formGroup]="formGroupStep1" class="form-step-content">
          <mat-form-field appearance="outline" class="form-field transaction-type-field">
            <mat-label>Transação</mat-label>
            <mat-select formControlName="transactionType" aria-required="true">
              <mat-option *ngFor="let type of transactionTypes" [value]="type.value">
                {{ type.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix></mat-icon>
            <mat-hint class="form-hint">Tipo de operação (Compra/Venda)</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep1.get('transactionType')?.hasError('required') && formGroupStep1.get('transactionType')?.touched">
              Selecione
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field asset-type-field">
            <mat-label>Tipo de Ativo</mat-label>
            <mat-select formControlName="assetType" aria-required="true">
              <mat-option *ngFor="let type of assetTypes" [value]="type.value">
                {{ type.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix></mat-icon>
            <mat-hint class="form-hint">Selecione o tipo do ativo</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep1.get('assetType')?.hasError('required') && formGroupStep1.get('assetType')?.touched">
              Selecione o tipo
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions">
            <button mat-raised-button color="primary" matStepperNext aria-label="Próxima etapa">Próximo</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="formGroupStep2" >
        <form [formGroup]="formGroupStep2" class="form-step-content">
          <mat-form-field appearance="outline" class="form-field ticker-field">
            <mat-label>Ticker</mat-label>
            <input matInput formControlName="ticker" placeholder="Ex: PETR4" aria-required="true">
            <mat-hint class="form-hint">Ex: PETR4, ITUB3</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('ticker')?.hasError('required') && formGroupStep2.get('ticker')?.touched">
              Informe o Ticker
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('ticker')?.hasError('minlength') && formGroupStep2.get('ticker')?.touched">
              Mínimo 3 caracteres
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('ticker')?.hasError('maxlength') && formGroupStep2.get('ticker')?.touched">
              Máximo 10 caracteres
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field description-field">
            <mat-label>
              {{ formGroupStep1.get('assetType')?.value === 'TÍTULO' ? 'Rentabilidade (%)' :
                 formGroupStep1.get('assetType')?.value === 'MOEDA' ? 'Cotação' : 'Descrição' }}
            </mat-label>
            <input matInput
                   formControlName="description"
                   [placeholder]="formGroupStep1.get('assetType')?.value === 'TÍTULO' ? 'Ex: 5.5' :
                                  formGroupStep1.get('assetType')?.value === 'MOEDA' ? 'Ex: 5.30' : 'Ex: Nome da Empresa'"
                   aria-required="true">
            <mat-hint class="form-hint">
              {{ formGroupStep1.get('assetType')?.value === 'TÍTULO' ? 'Ex: 5.5 para 5.5%' :
                 formGroupStep1.get('assetType')?.value === 'MOEDA' ? 'Ex: 5.30 para R$5,30' : 'Nome completo do ativo' }}
            </mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('description')?.hasError('required') && formGroupStep2.get('description')?.touched">
              Obrigatório
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('description')?.hasError('invalidPercentage') && formGroupStep2.get('description')?.touched">
              Informe um valor positivo (ex: 5.5)
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('description')?.hasError('invalidCurrency') && formGroupStep2.get('description')?.touched">
              Informe um valor positivo (ex: 5.30)
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field quantity-field">
            <mat-label>Quantidade</mat-label>
            <input matInput type="number" formControlName="quantity" min="1" aria-required="true">
            <mat-hint class="form-hint">Ex: 100</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('quantity')?.hasError('required') && formGroupStep2.get('quantity')?.touched">
              Informe a quantidade
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupStep2.get('quantity')?.hasError('min') && formGroupStep2.get('quantity')?.touched">
              Mínimo 1
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions">
            <button mat-raised-button color="primary" matStepperPrevious aria-label="Voltar etapa">Voltar</button>
            <button mat-raised-button color="primary" matStepperNext aria-label="Próxima etapa">Próximo</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="formGroupStep3" >
        <form [formGroup]="formGroupStep3" class="form-step-content">
          <mat-form-field appearance="outline" class="form-field corretora-field">
            <mat-label>Corretora</mat-label>
            <input matInput formControlName="corretora" placeholder="Ex: XP Investimentos" aria-required="true">
            <mat-hint class="form-hint">Ex: XP Investimentos</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep3.get('corretora')?.hasError('required') && formGroupStep3.get('corretora')?.touched">
              Informe a corretora
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions">
            <button mat-raised-button color="primary" matStepperPrevious aria-label="Voltar etapa">Voltar</button>
            <button mat-raised-button color="primary" matStepperNext aria-label="Próxima etapa">Próximo</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="formGroupStep4">
        <form [formGroup]="formGroupStep4" class="form-step-content">
          <mat-form-field appearance="outline" class="form-field date-field">
            <mat-label>Data da Transação</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="date" aria-required="true">
            <mat-datepicker-toggle matSuffix [for]="picker">
              <mat-icon matDatepickerToggleIcon>calendar_today</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-hint class="form-hint">Ex: 18/04/2025</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep4.get('date')?.hasError('required') && formGroupStep4.get('date')?.touched">
              Informe a data
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions">
            <button mat-raised-button color="primary" matStepperPrevious aria-label="Voltar etapa">Voltar</button>
            <button mat-raised-button color="primary" matStepperNext aria-label="Próxima etapa">Próximo</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="formGroupStep5">
        <form [formGroup]="formGroupStep5" class="form-step-content">
          <mat-form-field appearance="outline" class="form-field price-field">
            <mat-label>Preço Médio ($)</mat-label>
            <input matInput type="number" step="0.01" formControlName="averagePrice" min="0.01" aria-required="true">
            <mat-hint class="form-hint">Ex: 14.50</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep5.get('averagePrice')?.hasError('required') && formGroupStep5.get('averagePrice')?.touched">
              Informe o preço médio
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupStep5.get('averagePrice')?.hasError('min') && formGroupStep5.get('averagePrice')?.touched">
              Mínimo 0,01
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field value-field">
            <mat-label>Valor da Transação ($)</mat-label>
            <input matInput type="number" step="0.01" formControlName="transactionValue" min="0.01" aria-required="true">
            <mat-hint class="form-hint">Ex: 1450.00</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupStep5.get('transactionValue')?.hasError('required') && formGroupStep5.get('transactionValue')?.touched">
              Informe o valor da transação
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupStep5.get('transactionValue')?.hasError('min') && formGroupStep5.get('transactionValue')?.touched">
              Mínimo 0,01
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions final-actions">
            <button mat-raised-button color="primary" matStepperPrevious aria-label="Voltar etapa">Voltar</button>
            <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!transactionForm.valid || isSubmitting" aria-label="Salvar transação">Salvar</button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions">
    <button mat-raised-button color="danger" (click)="onCancel()" aria-label="Cancelar">Cancelar</button>
    <button mat-raised-button color="warn"  (click)="onClean()" aria-label="Limpar">Limpar</button>
  </mat-dialog-actions>
</div>
