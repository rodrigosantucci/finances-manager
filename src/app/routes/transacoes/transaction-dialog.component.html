<div class="dialog-container">
  <h2 mat-dialog-title class="dialog-title">{{ 'transaction.title' | translate }}</h2>
  <mat-dialog-content class="dialog-content">
    <mat-horizontal-stepper [linear]="true" #stepper class="transaction-stepper">
      <mat-step [stepControl]="formGroupDadosIniciais">
        <form [formGroup]="formGroupDadosIniciais" class="form-step-content">
          <mat-form-field appearance="outline" class="form-field transaction-type-field">
            <mat-label>{{ 'transaction.fields.transaction' | translate }}</mat-label>
            <mat-select formControlName="transactionType" aria-required="true">
              <mat-option *ngFor="let type of transactionTypes" [value]="type.value">
                {{ type.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>swap_horiz</mat-icon>
            <mat-hint class="form-hint">{{ 'transaction.hints.operation_type' | translate }}</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupDadosIniciais.get('transactionType')?.hasError('required') && formGroupDadosIniciais.get('transactionType')?.touched">
              {{ 'transaction.errors.select_transaction_type' | translate }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="form-field asset-type-field">
            <mat-label>{{ 'transaction.fields.asset_type' | translate }}</mat-label>
            <mat-select formControlName="assetType" aria-required="true">
              <mat-option *ngFor="let type of assetTypes" [value]="type.value">
                {{ type.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>category</mat-icon>
            <mat-hint class="form-hint">{{ 'transaction.hints.select_asset_type' | translate }}</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupDadosIniciais.get('assetType')?.hasError('required') && formGroupDadosIniciais.get('assetType')?.touched">
              {{ 'transaction.errors.select_asset_type' | translate }}
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions">
            <button mat-raised-button color="primary" matStepperNext [attr.aria-label]="'common.next' | translate">{{ 'common.next' | translate }}</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="formGroupDetalhesAtivo">
        <form [formGroup]="formGroupDetalhesAtivo" class="form-step-content">
          <!-- Campo Ticker (exibir apenas se assetType não for TÍTULO) -->
          <mat-form-field appearance="outline" class="form-field ticker-field" *ngIf="formGroupDadosIniciais.get('assetType')?.value !== 'TÍTULO'">
            <mat-label>{{ 'transaction.fields.ticker' | translate }}</mat-label>
            <input matInput formControlName="ticker" [placeholder]="'transaction.placeholders.ticker' | translate" aria-required="true">
            <mat-hint class="form-hint">{{ 'transaction.hints.ticker_examples' | translate }}</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('ticker')?.hasError('required') && formGroupDetalhesAtivo.get('ticker')?.touched">
              {{ 'transaction.errors.ticker_required' | translate }}
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('ticker')?.hasError('minlength') && formGroupDetalhesAtivo.get('ticker')?.touched">
              {{ 'transaction.errors.min_char_1' | translate }}
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('ticker')?.hasError('maxlength') && formGroupDetalhesAtivo.get('ticker')?.touched">
              {{ 'transaction.errors.max_char_10' | translate }}
            </mat-error>
          </mat-form-field>

          <!-- Campo Descrição -->
          <mat-form-field appearance="outline" class="form-field description-field">
            <mat-label>
              {{ formGroupDadosIniciais.get('assetType')?.value === 'TÍTULO' ? ('transaction.fields.title_name' | translate) :
                 formGroupDadosIniciais.get('assetType')?.value === 'MOEDA' ? ('transaction.fields.quote' | translate) : ('transaction.fields.description' | translate) }}
            </mat-label>
            <input matInput
                   formControlName="description"
                   [placeholder]="formGroupDadosIniciais.get('assetType')?.value === 'TÍTULO' ? ('transaction.placeholders.title_example' | translate) :
                                  formGroupDadosIniciais.get('assetType')?.value === 'MOEDA' ? ('transaction.placeholders.quote_example' | translate) : ('transaction.placeholders.description_example' | translate)"
                   aria-required="true">
            <mat-hint class="form-hint">
              {{ formGroupDadosIniciais.get('assetType')?.value === 'TÍTULO' ? ('transaction.hints.title_hint' | translate) :
                 formGroupDadosIniciais.get('assetType')?.value === 'MOEDA' ? ('transaction.hints.quote_hint' | translate) : ('transaction.hints.description_hint' | translate) }}
            </mat-hint>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('description')?.hasError('required') && formGroupDetalhesAtivo.get('description')?.touched">
              {{ 'common.required' | translate }}
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('description')?.hasError('invalidPercentage') && formGroupDetalhesAtivo.get('description')?.touched">
              {{ 'transaction.errors.positive_value_example_55' | translate }}
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('description')?.hasError('invalidCurrency') && formGroupDetalhesAtivo.get('description')?.touched">
              {{ 'transaction.errors.positive_value_example_530' | translate }}
            </mat-error>
          </mat-form-field>

          <!-- Campo Quantidade (exibir apenas se assetType não for TÍTULO) -->
          <mat-form-field appearance="outline" class="form-field quantity-field" *ngIf="formGroupDadosIniciais.get('assetType')?.value !== 'TÍTULO'">
            <mat-label>{{ 'transaction.fields.quantity' | translate }}</mat-label>
            <input matInput type="number" formControlName="quantity" min="0" aria-required="true">
            <mat-hint class="form-hint">{{ 'transaction.hints.quantity_example' | translate }}</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('quantity')?.hasError('required') && formGroupDetalhesAtivo.get('quantity')?.touched">
              {{ 'transaction.errors.quantity_required' | translate }}
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('quantity')?.hasError('min') && formGroupDetalhesAtivo.get('quantity')?.touched">
              {{ 'transaction.errors.min_1' | translate }}
            </mat-error>
          </mat-form-field>

          <!-- Campo Corretora -->
          <mat-form-field appearance="outline" class="form-field corretora-field">
            <mat-label>{{ 'transaction.fields.broker' | translate }}</mat-label>
            <mat-select formControlName="corretora" aria-required="true">
              <mat-option *ngFor="let broker of brokers" [value]="broker">
                {{ broker }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>account_balance</mat-icon>
            <mat-hint class="form-hint">{{ 'transaction.hints.select_broker' | translate }}</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupDetalhesAtivo.get('corretora')?.hasError('required') && formGroupDetalhesAtivo.get('corretora')?.touched">
              {{ 'transaction.errors.select_broker' | translate }}
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions">
            <button mat-raised-button color="primary" matStepperPrevious [attr.aria-label]="'common.back' | translate">{{ 'common.back' | translate }}</button>
            <button mat-raised-button color="primary" matStepperNext [attr.aria-label]="'common.next' | translate">{{ 'common.next' | translate }}</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="formGroupValoresData">
        <form [formGroup]="formGroupValoresData" class="form-step-content">
          <!-- Campo Data da Transação -->
          <mat-form-field appearance="outline" class="form-field date-field">
            <mat-label>{{ 'transaction.fields.transaction_date' | translate }}</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="date" aria-required="true">
            <mat-datepicker-toggle matSuffix [for]="picker">
              <mat-icon matDatepickerToggleIcon>calendar_today</mat-icon>
            </mat-datepicker-toggle>
            <mat-datepicker #picker />
            <mat-hint class="form-hint">{{ 'transaction.hints.date_example' | translate }}</mat-hint>
            <mat-error class="form-error" *ngIf="formGroupValoresData.get('date')?.hasError('required') && formGroupValoresData.get('date')?.touched">
              {{ 'transaction.errors.date_required' | translate }}
            </mat-error>
          </mat-form-field>

          <!-- Campo Preço Médio (exibir apenas se assetType não for TÍTULO) -->
          <mat-form-field appearance="outline" class="form-field price-field" *ngIf="formGroupDadosIniciais.get('assetType')?.value !== 'TÍTULO'">
            <mat-label>
              {{ 'transaction.fields.average_price' | translate }} ({{ formGroupDadosIniciais.get('assetType')?.value === 'AÇÃO_EXTERIOR' ||
                              formGroupDadosIniciais.get('assetType')?.value === 'FUNDO_EXTERIOR' ||
                              formGroupDadosIniciais.get('assetType')?.value === 'MOEDA' ? '$' : 'R$' }})
            </mat-label>
            <input matInput
                   type="number" mask="separator.2" thousandSeparator="." decimalMarker="," formControlName="averagePrice"
                   aria-required="true">
            <mat-hint class="form-hint">
              {{ 'transaction.hints.average_price_example' | translate }}
            </mat-hint>
            <mat-error class="form-error" *ngIf="formGroupValoresData.get('averagePrice')?.hasError('required') && formGroupValoresData.get('averagePrice')?.touched">
              {{ 'transaction.errors.average_price_required' | translate }}
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupValoresData.get('averagePrice')?.hasError('min') && formGroupValoresData.get('averagePrice')?.touched">
              {{ 'transaction.errors.min_001' | translate }}
            </mat-error>
          </mat-form-field>

          <!-- Campo Valor da Transação -->
          <mat-form-field appearance="outline" class="form-field value-field">
            <mat-label>
              {{ 'transaction.fields.transaction_value' | translate }} ({{ formGroupDadosIniciais.get('assetType')?.value === 'AÇÃO_EXTERIOR' ||
                                     formGroupDadosIniciais.get('assetType')?.value === 'FUNDO_EXTERIOR' ||
                                     formGroupDadosIniciais.get('assetType')?.value === 'MOEDA' ? '$' : 'R$' }})
            </mat-label>
            <input matInput
                   type="number" mask="separator.2" thousandSeparator="." decimalMarker="," formControlName="transactionValue"
                   aria-required="true">
            <mat-hint class="form-hint">
              {{ 'transaction.hints.transaction_value_example' | translate }}
            </mat-hint>
            <mat-error class="form-error" *ngIf="formGroupValoresData.get('transactionValue')?.hasError('required') && formGroupValoresData.get('transactionValue')?.touched">
              {{ 'transaction.errors.transaction_value_required' | translate }}
            </mat-error>
            <mat-error class="form-error" *ngIf="formGroupValoresData.get('transactionValue')?.hasError('min') && formGroupValoresData.get('transactionValue')?.touched">
              {{ 'transaction.errors.min_001' | translate }}
            </mat-error>
          </mat-form-field>

          <div class="stepper-actions final-actions">
            <button mat-raised-button color="primary" matStepperPrevious [attr.aria-label]="'common.back' | translate">{{ 'common.back' | translate }}</button>
            <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!transactionForm.valid || isSubmitting" [attr.aria-label]="'transaction.actions.save_transaction' | translate">{{ 'common.save' | translate }}</button>
          </div>
        </form>
      </mat-step>
    </mat-horizontal-stepper>
  </mat-dialog-content>

  <mat-dialog-actions class="dialog-actions">
    <button mat-raised-button color="danger" (click)="onCancel()" [attr.aria-label]="'common.cancel' | translate">{{ 'common.cancel' | translate }}</button>
    <button mat-raised-button color="warn" (click)="onClean()" [attr.aria-label]="'common.clean' | translate">{{ 'common.clean' | translate }}</button>
  </mat-dialog-actions>
</div>
