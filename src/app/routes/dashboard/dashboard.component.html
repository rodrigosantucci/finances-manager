<section class="header-section" aria-labelledby="header-title">
  <div *ngIf="isShowAlert">
    <mtx-alert type="info" dismissible (closed)="onAlertDismiss()">
      üéâ Novidade!
      <a [href]="introducingItem.link" target="_blank">{{ introducingItem.name }}</a>
      - {{ introducingItem.description }}
      <a [href]="introducingItem.link" target="_blank">Veja mais!</a>
    </mtx-alert>
  </div>

  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>
    <div id="tradingview-widget"></div>
  </div>

  <div
    *ngIf="isLoading"
    class="loading-indicator text-center my-4"
    role="status"
    aria-live="polite"
  >
    <mat-spinner diameter="40" aria-label="Carregando dados" />
    <p>Carregando dados...</p>
  </div>

  <div *ngIf="hasError" class="error-container" role="alert" aria-live="assertive">
    <mat-icon color="warn" aria-hidden="true">error_outline</mat-icon>
    <p>Erro ao carregar os dados. Tente novamente mais tarde.</p>
    <button
      mat-raised-button
      color="primary"
      (click)="loadData(currentUserId!)"
      aria-label="Tentar novamente"
    >
      Tentar Novamente
    </button>
  </div>
</section>

<div *ngIf="!isLoading && !hasError" class="dashboard-container">
  <section class="resumo-section mb-4" aria-labelledby="resumo-title">
    <h2 id="resumo-title" class="section-title">Resumo do Patrim√¥nio</h2>
    <div class="row">
      <div class="col-md-2 col-4 flex-column justify-content-between">
        <mat-card class="summary-card">
          <mat-card-content class="d-flex flex-column h-100">
            <div class="button-controls mb-4 d-flex justify-content-center gap-10">
              <div class="metric mb-2 text-center">
                <p class="metric-label">Nova Transa√ß√£o</p>
                <p class="metric-value">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="openTransactionDialog()"
                    matTooltip="Adicionar nova transa√ß√£o"
                    aria-label="Adicionar nova transa√ß√£o"
                  >
                    <mat-icon>add</mat-icon>
                  </button>
                </p>
              </div>
              <div class="metric mb-2 text-center">
                <p class="metric-label">Recarregar Dados</p>
                <p class="metric-value">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="onUpdateCotacoes()"
                    [disabled]="isUpdating"
                    matTooltip="Atualizar dados"
                    aria-label="Atualizar dados"
                  >
                    <mat-icon>refresh</mat-icon>
                  </button>
                </p>
              </div>
            </div>
            <div class="metrics d-flex flex-column flex-grow-1 justify-content-center">
              <div class="metric mb-2 text-center">
                <p class="metric-label">Total Investido</p>
                <p class="metric-value">
                  <span class="text-primary font-weight-bold">
                    {{ getTotalInvestido() | currency: 'BRL' }}
                  </span>
                </p>
              </div>
              <div class="metric text-center">
                <p class="metric-label">Lucro/Preju√≠zo Total</p>
                <p class="metric-value">
                  <span
                    [ngClass]="getTotalLucroPrejuizoGeral() >= 0 ? 'text-success' : 'text-danger'"
                  >
                    {{ getTotalLucroPrejuizoGeral() | currency: 'BRL' }}
                  </span>
                </p>
              </div>
              <div class="metric text-center">
                <p class="metric-label">Total Exterior:</p>
                <p class="metric-label">
                  <span class="metric-value"> </span>
                 {{ getTotalValorExterior()  | currency: 'BRL' }}
                </p>
              </div>
              <div class="metric text-center">
                <p class="metric-label">
                  Renda Fixa:
                  <span class="metric-value">{{ getPercentualRF() }}%</span>
                </p>
                <p class="metric-label">
                  Renda Vari√°vel:
                  <span class="metric-value">{{ getPercentualRV() }}%</span>
                </p>
                <p class="metric-label">
                  Exterior:
                  <span class="metric-value">{{ getPercentualExterior() }}%</span>
                </p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      <div class="col-6 col-md-6">
        <mat-card class="table-card">
          <mat-card-content>
            <table mat-table [dataSource]="distribuicaoDataSource" class="w-100">
              <ng-container matColumnDef="tipoAtivo">
                <th mat-header-cell *matHeaderCellDef>Tipo de Ativo</th>
                <td mat-cell *matCellDef="let element">{{ element.tipoAtivo }}</td>
                <td mat-footer-cell *matFooterCellDef><b>TOTAL</b></td>
              </ng-container>
              <ng-container matColumnDef="percentual">
                <th mat-header-cell *matHeaderCellDef>Percentual</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.percentual | number: '1.2-2' }}%
                </td>
                <td mat-footer-cell *matFooterCellDef><b></b></td>
              </ng-container>
              <ng-container matColumnDef="valorTotal">
                <th mat-header-cell *matHeaderCellDef>Valor Total</th>
                <td mat-cell *matCellDef="let element">
                  {{ element.valorTotal | currency: 'BRL' }}
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalInvestido() | currency: 'BRL' }}
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="patrimonioColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: patrimonioColumns"></tr>
              <tr mat-footer-row *matFooterRowDef="patrimonioColumns"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
      <div class="col-4 col-md-4">
        <mat-card class="chart-card">
          <mat-card-content class="d-flex justify-content-center">
            <div
              #chart1
              id="chart1"
              role="img"
              aria-label="Gr√°fico de distribui√ß√£o de patrim√¥nio"
            ></div>
            <p *ngIf="!(patrimoniochart$ | async)?.series?.length" class="no-data-text">
              Nenhum dado dispon√≠vel para distribui√ß√£o de patrim√¥nio
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>

  <section class="acoes-section mb-4" aria-labelledby="acos-title">
    <h2 id="acos-title" class="section-title">A√ß√µes</h2>
    <div class="row">
      <div class="col-12 col-md-8">
        <mat-card class="table-card">
          <mat-card-content>
            <table mat-table [dataSource]="acoesDataSource" class="w-100">
              <ng-container matColumnDef="tickerFormatado">
                <th mat-header-cell *matHeaderCellDef>Ticker</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.tickerFormatado }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.tickerFormatado"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef><b>TOTAL</b></td>
              </ng-container>
              <ng-container matColumnDef="descricaoFormatada">
                <th mat-header-cell *matHeaderCellDef>Nome</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.descricaoFormatada }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.descricaoFormatada"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="quantidadeFormatada">
                <th mat-header-cell *matHeaderCellDef>Quantidade</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.quantidadeFormatada | quantidadeFormat }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.quantidadeFormatada"
                    class="form-control"
                    type="number"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="precoMedioFormatado">
                <th mat-header-cell *matHeaderCellDef>Pre√ßo M√©dio</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.precoMedioFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.precoMedioFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="valorInvestidoFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Investido</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorInvestidoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorInvestidoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorInvestidoAcoes() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="valorAtualFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Atual</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorAtualFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorAtualFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorAtualAcoes() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="lucroPrejuizoFormatado">
                <th mat-header-cell *matHeaderCellDef>Lucro/Preju√≠zo</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{
                    'text-success': element.lucroPrejuizoFormatado >= 0,
                    'text-danger': element.lucroPrejuizoFormatado < 0,
                  }"
                >
                  <span *ngIf="!isEditing(element)">
                    {{ element.lucroPrejuizoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.lucroPrejuizoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  <span
                    [ngClass]="getTotalLucroPrejuizoAcoes() >= 0 ? 'text-success' : 'text-danger'"
                  >
                    {{ getTotalLucroPrejuizoAcoes() | currency: 'BRL' }}
                  </span>
                </td>
              </ng-container>
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Editar</th>
                <td mat-cell *matCellDef="let element">
                  <ng-container *ngIf="!isEditing(element)">
                                        <div class="action-buttons-group">

                    <button
                      mat-icon-button
                      color="primary"
                      (click)="startEdit(element, 'acoes')"
                      matTooltip="Editar ativo"
                      aria-label="Editar ativo"
                    >
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button
                      mat-icon-button
                      color="warn"
                      (click)="openDeleteDialog(element, 'acoes')"
                      matTooltip="Excluir ativo"
                      aria-label="Excluir ativo"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                                        </div>
                  </ng-container>
                  <ng-container *ngIf="isEditing(element)">
                                        <div class="action-buttons-group">

                    <button
                      mat-icon-button
                      color="accent"
                      (click)="saveEdit(element, 'acoes')"
                      matTooltip="Salvar edi√ß√£o"
                      aria-label="Salvar edi√ß√£o"
                    >
                      <mat-icon>save</mat-icon>
                    </button>
                    <button
                      mat-icon-button
                      color="basic"
                      (click)="cancelEdit()"
                      matTooltip="Cancelar edi√ß√£o"
                      aria-label="Cancelar edi√ß√£o"
                    >
                      <mat-icon>cancel</mat-icon>
                    </button>
                                        </div>
                  </ng-container>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="acoesColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: acoesColumns"></tr>
              <tr mat-footer-row *matFooterRowDef="acoesColumns"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
      <div class="col-12 col-md-4">
        <mat-card class="chart-card">
          <mat-card-content class="d-flex justify-content-center">
            <div #chart2 id="chart2" role="img" aria-label="Gr√°fico de distribui√ß√£o de a√ß√µes"></div>
            <p *ngIf="!(acoesChart$ | async)?.series?.length" class="no-data-text">
              Nenhum dado dispon√≠vel para a√ß√µes
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>

  <section class="acoes-section mb-4" aria-labelledby="fundos-title">
    <h2 id="fundos-title" class="section-title">Fundos</h2>
    <div class="row">
      <div class="col-12 col-md-8">
        <mat-card class="table-card">
          <mat-card-content>
            <table mat-table [dataSource]="fundosDataSource" class="w-100">
              <ng-container matColumnDef="tickerFormatado">
                <th mat-header-cell *matHeaderCellDef>Ticker</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.tickerFormatado }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.tickerFormatado"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef><b>TOTAL</b></td>
              </ng-container>
              <ng-container matColumnDef="descricaoFormatada">
                <th mat-header-cell *matHeaderCellDef>Nome</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.descricaoFormatada }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.descricaoFormatada"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="quantidadeFormatada">
                <th mat-header-cell *matHeaderCellDef>Quantidade</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.quantidadeFormatada | quantidadeFormat }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.quantidadeFormatada"
                    class="form-control"
                    type="number"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="precoMedioFormatado">
                <th mat-header-cell *matHeaderCellDef>Pre√ßo M√©dio</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.precoMedioFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.precoMedioFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="valorInvestidoFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Investido</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorInvestidoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorInvestidoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorInvestidoFundos() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="valorAtualFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Atual</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorAtualFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorAtualFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorAtualFundos() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="lucroPrejuizoFormatado">
                <th mat-header-cell *matHeaderCellDef>Lucro/Preju√≠zo</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{
                    'text-success': element.lucroPrejuizoFormatado >= 0,
                    'text-danger': element.lucroPrejuizoFormatado < 0,
                  }"
                >
                  <span *ngIf="!isEditing(element)">
                    {{ element.lucroPrejuizoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.lucroPrejuizoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  <span
                    [ngClass]="getTotalLucroPrejuizoFundos() >= 0 ? 'text-success' : 'text-danger'"
                  >
                    {{ getTotalLucroPrejuizoFundos() | currency: 'BRL' }}
                  </span>
                </td>
              </ng-container>
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Editar</th>
                <td mat-cell *matCellDef="let element">
                  <ng-container *ngIf="!isEditing(element)">
                                        <div class="action-buttons-group">

                    <button
                      mat-icon-button
                      color="primary"
                      (click)="startEdit(element, 'fundos')"
                      matTooltip="Editar fundo"
                      aria-label="Editar fundo"
                    >
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button
                      mat-icon-button
                      color="warn"
                      (click)="openDeleteDialog(element, 'fundos')"
                      matTooltip="Excluir fundo"
                      aria-label="Excluir fundo"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                                        </div>
                  </ng-container>
                  <ng-container *ngIf="isEditing(element)">
                                        <div class="action-buttons-group">

                    <button
                      mat-icon-button
                      color="accent"
                      (click)="saveEdit(element, 'fundos')"
                      matTooltip="Salvar edi√ß√£o"
                      aria-label="Salvar edi√ß√£o"
                    >
                      <mat-icon>save</mat-icon>
                    </button>
                    <button
                      mat-icon-button
                      color="basic"
                      (click)="cancelEdit()"
                      matTooltip="Cancelar edi√ß√£o"
                      aria-label="Cancelar edi√ß√£o"
                    >
                      <mat-icon>cancel</mat-icon>
                    </button>
                                        </div>
                  </ng-container>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="fundosColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: fundosColumns"></tr>
              <tr mat-footer-row *matFooterRowDef="fundosColumns"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
      <div class="col-12 col-md-4">
        <mat-card class="chart-card">
          <mat-card-content class="d-flex justify-content-center">
            <div
              #chart3
              id="chart3"
              role="img"
              aria-label="Gr√°fico de distribui√ß√£o de fundos"
            ></div>
            <p *ngIf="!(fundosChart$ | async)?.series?.length" class="no-data-text">
              Nenhum dado dispon√≠vel para fundos
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>

  <section class="acoes-section mb-4" aria-labelledby="caixa-title">
    <h2 id="caixa-title" class="section-title">Caixa</h2>
    <div class="row">
      <div class="col-12 col-md-8">
        <mat-card class="table-card">
          <mat-card-content>
            <table mat-table [dataSource]="caixaDataSource" class="w-100">
              <ng-container matColumnDef="tickerFormatado">
                <th mat-header-cell *matHeaderCellDef>Ticker</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.tickerFormatado }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.tickerFormatado"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef><b>TOTAL</b></td>
              </ng-container>
              <ng-container matColumnDef="descricaoFormatada">
                <th mat-header-cell *matHeaderCellDef>Nome</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.descricaoFormatada }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.descricaoFormatada"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="quantidadeFormatada">
                <th mat-header-cell *matHeaderCellDef>Quantidade</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.quantidadeFormatada | quantidadeFormat }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.quantidadeFormatada"
                    class="form-control"
                    type="number"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="precoMedioFormatado">
                <th mat-header-cell *matHeaderCellDef>Pre√ßo M√©dio</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.precoMedioFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.precoMedioFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="valorInvestidoFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Investido</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorInvestidoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorInvestidoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorInvestidoCaixa() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="valorAtualFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Atual</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorAtualFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorAtualFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorAtualCaixa() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="lucroPrejuizoFormatado">
                <th mat-header-cell *matHeaderCellDef>Lucro/Preju√≠zo</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{
                    'text-success': element.lucroPrejuizoFormatado >= 0,
                    'text-danger': element.lucroPrejuizoFormatado < 0,
                  }"
                >
                  <span *ngIf="!isEditing(element)">
                    {{ element.lucroPrejuizoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.lucroPrejuizoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  <span
                    [ngClass]="getTotalLucroPrejuizoCaixa() >= 0 ? 'text-success' : 'text-danger'"
                  >
                    {{ getTotalLucroPrejuizoCaixa() | currency: 'BRL' }}
                  </span>
                </td>
              </ng-container>
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Editar</th>
                <td mat-cell *matCellDef="let element">
                  <ng-container *ngIf="!isEditing(element)">
                    <div class="action-buttons-group">
                      <button
                        mat-icon-button
                        color="primary"
                        (click)="startEdit(element, 'caixa')"
                        matTooltip="Editar caixa"
                        aria-label="Editar caixa"
                      >
                        <mat-icon>edit</mat-icon>
                      </button>
                      <button
                        mat-icon-button
                        color="warn"
                        (click)="openDeleteDialog(element, 'caixa')"
                        matTooltip="Excluir caixa"
                        aria-label="Excluir caixa"
                      >
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="isEditing(element)">
                    <div class="action-buttons-group">
                      <button
                        mat-icon-button
                        color="accent"
                        (click)="saveEdit(element, 'caixa')"
                        matTooltip="Salvar edi√ß√£o"
                        aria-label="Salvar edi√ß√£o"
                      >
                        <mat-icon>save</mat-icon>
                      </button>
                      <button
                        mat-icon-button
                        color="basic"
                        (click)="cancelEdit()"
                        matTooltip="Cancelar edi√ß√£o"
                        aria-label="Cancelar edi√ß√£o"
                      >
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </div>
                  </ng-container>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="caixaColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: caixaColumns"></tr>
              <tr mat-footer-row *matFooterRowDef="caixaColumns"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
      <div class="col-12 col-md-4">
        <mat-card class="chart-card">
          <mat-card-content class="d-flex justify-content-center">
            <div #chart4 id="chart4" role="img" aria-label="Gr√°fico de distribui√ß√£o de caixa"></div>
            <p *ngIf="!(caixaChart$ | async)?.series?.length" class="no-data-text">
              Nenhum dado dispon√≠vel para caixa
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>

  <section class="acoes-section mb-4" aria-labelledby="assets-title">
    <h2 id="assets-title" class="section-title">Assets Internacionais</h2>
    <div class="row">
      <div class="col-12 col-md-8">
        <mat-card class="table-card">
          <mat-card-content>
            <table mat-table [dataSource]="assetsDataSource" class="w-100">
              <ng-container matColumnDef="tickerFormatado">
                <th mat-header-cell *matHeaderCellDef>Ticker</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.tickerFormatado }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.tickerFormatado"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef><b>TOTAL</b></td>
              </ng-container>
              <ng-container matColumnDef="descricaoFormatada">
                <th mat-header-cell *matHeaderCellDef>Nome</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">{{ element.descricaoFormatada }}</span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.descricaoFormatada"
                    class="form-control"
                    type="text"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="quantidadeFormatada">
                <th mat-header-cell *matHeaderCellDef>Quantidade</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.quantidadeFormatada | quantidadeFormat }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.quantidadeFormatada"
                    class="form-control"
                    type="number"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="precoMedioFormatado">
                <th mat-header-cell *matHeaderCellDef>Pre√ßo M√©dio</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.precoMedioFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.precoMedioFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <ng-container matColumnDef="valorInvestidoFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Investido</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorInvestidoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorInvestidoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorInvestidoAssets() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="valorAtualFormatado">
                <th mat-header-cell *matHeaderCellDef>Valor Atual</th>
                <td mat-cell *matCellDef="let element">
                  <span *ngIf="!isEditing(element)">
                    {{ element.valorAtualFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.valorAtualFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  {{ getTotalValorAtualAssets() | currency: 'BRL' }}
                </td>
              </ng-container>
              <ng-container matColumnDef="lucroPrejuizoFormatado">
                <th mat-header-cell *matHeaderCellDef>Lucro/Preju√≠zo</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  [ngClass]="{
                    'text-success': element.lucroPrejuizoFormatado >= 0,
                    'text-danger': element.lucroPrejuizoFormatado < 0,
                  }"
                >
                  <span *ngIf="!isEditing(element)">
                    {{ element.lucroPrejuizoFormatado | currency: 'BRL' }}
                  </span>
                  <input
                    *ngIf="isEditing(element)"
                    [(ngModel)]="currentEditedAtivo!.lucroPrejuizoFormatado"
                    class="form-control"
                    type="number"
                    step="0.01"
                  />
                </td>
                <td mat-footer-cell *matFooterCellDef>
                  <span
                    [ngClass]="getTotalLucroPrejuizoAssets() >= 0 ? 'text-success' : 'text-danger'"
                  >
                    {{ getTotalLucroPrejuizoAssets() | currency: 'BRL' }}
                  </span>
                </td>
              </ng-container>
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Editar</th>
                <td mat-cell *matCellDef="let element">
                  <ng-container *ngIf="!isEditing(element)">
                    <div class="action-buttons-group">
                      <button
                        mat-icon-button
                        color="primary"
                        (click)="startEdit(element, 'assets')"
                        matTooltip="Editar ativo internacional"
                        aria-label="Editar ativo internacional"
                      >
                        <mat-icon>edit</mat-icon>
                      </button>
                      <button
                        mat-icon-button
                        color="warn"
                        (click)="openDeleteDialog(element, 'assets')"
                        matTooltip="Excluir ativo internacional"
                        aria-label="Excluir ativo internacional"
                      >
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </ng-container>

                  <ng-container *ngIf="isEditing(element)">
                    <div class="action-buttons-group">
                      <button
                        mat-icon-button
                        color="accent"
                        (click)="saveEdit(element, 'assets')"
                        matTooltip="Salvar edi√ß√£o"
                        aria-label="Salvar edi√ß√£o"
                      >
                        <mat-icon>save</mat-icon>
                      </button>
                      <button
                        mat-icon-button
                        color="basic"
                        (click)="cancelEdit()"
                        matTooltip="Cancelar edi√ß√£o"
                        aria-label="Cancelar edi√ß√£o"
                      >
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </div>
                  </ng-container>
                </td>
                <td mat-footer-cell *matFooterCellDef></td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="assetsColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: assetsColumns"></tr>
              <tr mat-footer-row *matFooterRowDef="assetsColumns"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
      <div class="col-12 col-md-4">
        <mat-card class="chart-card">
          <mat-card-content class="d-flex justify-content-center">
            <div
              #chart5
              id="chart5"
              role="img"
              aria-label="Gr√°fico de distribui√ß√£o de assets internacionais"
            ></div>
            <p *ngIf="!(assetsChart$ | async)?.series?.length" class="no-data-text">
              Nenhum dado dispon√≠vel para assets internacionais
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  </section>
</div>
