
<page-header class="bg-dark text-light" title="Ferramentas" />

<div class="container">
  <mat-tab-group>
    <!-- Tab 1: Distribuidor de Aporte -->
    <mat-tab label="Distribuidor de Aportes">
      <div class="container" id="allocation">
        <header class="header">
          <h1>Distribuidor de Aportes</h1>
        </header>
        <form id="allocatorForm" (ngSubmit)="onSubmitAllocation()">
          <div class="form-group">
            <label for="totalAmount">Valor Total a Aportar (R$):</label>
            <input type="text" id="totalAmount" placeholder="Ex: 10.000,00" [(ngModel)]="totalAmount" name="totalAmount" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)" required>
          </div>
          <div class="form-group">
            <label>Distribuição das Categorias (%):</label>
            <div class="chart-container">
              <canvas id="allocationChart"></canvas>
              <div class="chart-instructions">Arraste o gráfico ou use os sliders para ajustar a porcentagem</div>
            </div>
            <div class="slider-container">
              <div class="slider-group">
                <label for="sliderStocks">Ações:</label>
                <input type="range" id="sliderStocks" min="0" max="100" step="0.1" [(ngModel)]="sliders.stocks" name="sliderStocks" (input)="handleSliderInput('stocks')">
                <span class="slider-value" id="sliderStocksValue">{{ sliders.stocks | number:'1.2-2' }}%</span>
              </div>
              <div class="slider-group">
                <label for="sliderFunds">Fundos:</label>
                <input type="range" id="sliderFunds" min="0" max="100" step="0.1" [(ngModel)]="sliders.funds" name="sliderFunds" (input)="handleSliderInput('funds')">
                <span class="slider-value" id="sliderFundsValue">{{ sliders.funds | number:'1.2-2' }}%</span>
              </div>
              <div class="slider-group">
                <label for="sliderTreasury">Títulos Públicos:</label>
                <input type="range" id="sliderTreasury" min="0" max="100" step="0.1" [(ngModel)]="sliders.treasury" name="sliderTreasury" (input)="handleSliderInput('treasury')">
                <span class="slider-value" id="sliderTreasuryValue">{{ sliders.treasury | number:'1.2-2' }}%</span>
              </div>
              <div class="slider-group">
                <label for="sliderIntl">Assets Internacionais:</label>
                <input type="range" id="sliderIntl" min="0" max="100" step="0.1" [(ngModel)]="sliders.intl" name="sliderIntl" (input)="handleSliderInput('intl')">
                <span class="slider-value" id="sliderIntlValue">{{ sliders.intl | number:'1.2-2' }}%</span>
              </div>
            </div>
            <div id="mainCategoryError" class="error-message" [style.display]="mainCategoryValid ? 'none' : 'block'">A soma das categorias deve ser exatamente 100%.</div>
          </div>
          <details class="category-section">
            <summary>Ações</summary>
            <div class="category-fields">
              <div class="form-group">
                <label for="stocksBlueChips">Ações Blue Chips (%):</label>
                <input type="text" id="stocksBlueChips" placeholder="Ex: 50" [(ngModel)]="stocksSubInputs.blueChips" name="stocksBlueChips" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="stocksSmallCaps">Ações Small Caps (%):</label>
                <input type="text" id="stocksSmallCaps" placeholder="Ex: 30" [(ngModel)]="stocksSubInputs.smallCaps" name="stocksSmallCaps" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="stocksGrowth">Ações de Crescimento (%):</label>
                <input type="text" id="stocksGrowth" placeholder="Ex: 20" [(ngModel)]="stocksSubInputs.growth" name="stocksGrowth" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="result-item">
                <p>Total: <span id="totalStocks">{{ totalStocks | number:'1.2-2' }}%</span></p>
              </div>
              <div id="stocksError" class="error-message" [style.display]="stocksValid ? 'none' : 'block'">A soma das subcategorias deve ser exatamente 100%.</div>
            </div>
          </details>
          <details class="category-section">
            <summary>Fundos</summary>
            <div class="category-fields">
              <div class="form-group">
                <label for="fundsFIIs">Fundos Imobiliários (FIIs) (%):</label>
                <input type="text" id="fundsFIIs" placeholder="Ex: 40" [(ngModel)]="fundsSubInputs.fiis" name="fundsFIIs" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="fundsStocks">Fundos de Ações (%):</label>
                <input type="text" id="fundsStocks" placeholder="Ex: 30" [(ngModel)]="fundsSubInputs.stocks" name="fundsStocks" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="fundsMulti">Fundos Multimercado (%):</label>
                <input type="text" id="fundsMulti" placeholder="Ex: 30" [(ngModel)]="fundsSubInputs.multi" name="fundsMulti" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="result-item">
                <p>Total: <span id="totalFunds">{{ totalFunds | number:'1.2-2' }}%</span></p>
              </div>
              <div id="fundsError" class="error-message" [style.display]="fundsValid ? 'none' : 'block'">A soma das subcategorias deve ser exatamente 100%.</div>
            </div>
          </details>
          <details class="category-section">
            <summary>Títulos Públicos</summary>
            <div class="category-fields">
              <div class="form-group">
                <label for="treasurySelic">Tesouro Direto Selic (%):</label>
                <input type="text" id="treasurySelic" placeholder="Ex: 50" [(ngModel)]="treasurySubInputs.selic" name="treasurySelic" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="treasuryIpca">Tesouro Direto IPCA+ (%):</label>
                <input type="text" id="treasuryIpca" placeholder="Ex: 30" [(ngModel)]="treasurySubInputs.ipca" name="treasuryIpca" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="treasuryPrefixed">Tesouro Direto Prefixado (%):</label>
                <input type="text" id="treasuryPrefixed" placeholder="Ex: 20" [(ngModel)]="treasurySubInputs.prefixed" name="treasuryPrefixed" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="result-item">
                <p>Total: <span id="totalTreasury">{{ totalTreasury | number:'1.2-2' }}%</span></p>
              </div>
              <div id="treasuryError" class="error-message" [style.display]="treasuryValid ? 'none' : 'block'">A soma das subcategorias deve ser exatamente 100%.</div>
            </div>
          </details>
          <details class="category-section">
            <summary>Assets Internacionais</summary>
            <div class="category-fields">
              <div class="form-group">
                <label for="intlEtfs">ETFs Globais (%):</label>
                <input type="text" id="intlEtfs" placeholder="Ex: 40" [(ngModel)]="intlSubInputs.etfs" name="intlEtfs" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="intlStocks">Ações Estrangeiras (%):</label>
                <input type="text" id="intlStocks" placeholder="Ex: 30" [(ngModel)]="intlSubInputs.stocks" name="intlStocks" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="form-group">
                <label for="intlFunds">Fundos Internacionais (%):</label>
                <input type="text" id="intlFunds" placeholder="Ex: 30" [(ngModel)]="intlSubInputs.funds" name="intlFunds" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)" (change)="updateSubcategoryTotals()">
              </div>
              <div class="result-item">
                <p>Total: <span id="totalIntl">{{ totalIntl | number:'1.2-2' }}%</span></p>
              </div>
              <div id="intlError" class="error-message" [style.display]="intlValid ? 'none' : 'block'">A soma das subcategorias deve ser exatamente 100%.</div>
            </div>
          </details>
          <div class="button-container">
            <button type="submit" class="calculate-button" [disabled]="!isFormValid">Calcular</button>
          </div>
        </form>
        <section id="results" class="results-section" [style.display]="showResultsAllocation ? 'block' : 'none'">
          <h2>Distribuição do Aportes</h2>
          <div class="result-item">
            <p>Ações:</p>
            <span id="amountStocks">{{ amounts.stocks | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Ações Blue Chips:</p>
            <span id="amountStocksBlueChips">{{ amounts.stocksBlueChips | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Ações Small Caps:</p>
            <span id="amountStocksSmallCaps">{{ amounts.stocksSmallCaps | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Ações de Crescimento:</p>
            <span id="amountStocksGrowth">{{ amounts.stocksGrowth | currency:'BRL' }}</span>
          </div>
          <div class="result-item">
            <p>Fundos:</p>
            <span id="amountFunds">{{ amounts.funds | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Fundos Imobiliários (FIIs):</p>
            <span id="amountFundsFIIs">{{ amounts.fundsFIIs | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Fundos de Ações:</p>
            <span id="amountFundsStocks">{{ amounts.fundsStocks | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Fundos Multimercado:</p>
            <span id="amountFundsMulti">{{ amounts.fundsMulti | currency:'BRL' }}</span>
          </div>
          <div class="result-item">
            <p>Títulos Públicos:</p>
            <span id="amountTreasury">{{ amounts.treasury | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Tesouro Direto Selic:</p>
            <span id="amountTreasurySelic">{{ amounts.treasurySelic | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Tesouro Direto IPCA+:</p>
            <span id="amountTreasuryIpca">{{ amounts.treasuryIpca | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Tesouro Direto Prefixado:</p>
            <span id="amountTreasuryPrefixed">{{ amounts.treasuryPrefixed | currency:'BRL' }}</span>
          </div>
          <div class="result-item">
            <p>Assets Internacionais:</p>
            <span id="amountIntl">{{ amounts.intl | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>ETFs Globais:</p>
            <span id="amountIntlEtfs">{{ amounts.intlEtfs | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Ações Estrangeiras:</p>
            <span id="amountIntlStocks">{{ amounts.intlStocks | currency:'BRL' }}</span>
          </div>
          <div class="result-item subcategory">
            <p>Fundos Internacionais:</p>
            <span id="amountIntlFunds">{{ amounts.intlFunds | currency:'BRL' }}</span>
          </div>
          <div class="chart-container">
            <canvas id="resultsChart"></canvas>
          </div>
          <div class="download-buttons">
            <button id="downloadPngAllocation" class="download-button" (click)="downloadPng('allocation')">Baixar PNG</button>
            <button id="downloadPdfAllocation" class="download-button" (click)="downloadPdf('allocation')">Baixar PDF</button>
          </div>
        </section>
      </div>
    </mat-tab>

    <!-- Tab 2: Calculadora Preço Teto -->
    <mat-tab label="Calculadora Preço Teto">
      <div class="container" id="ceilingPrice">
        <header class="header">
          <h1>Calculadora Preço Teto</h1>
        </header>
        <form id="ceilingPriceForm" (ngSubmit)="onSubmitCeilingPrice()">
          <div class="form-grid">
            <div class="form-group">
              <label for="ticker">Código da Ação (Ticker):</label>
              <input type="text" id="ticker" placeholder="Ex: BBAS3" [(ngModel)]="ticker" name="ticker" required>
            </div>
            <div class="form-group">
              <label for="dividends">Dividendos Médios Anuais (R$):</label>
              <input type="text" id="dividends" placeholder="Ex: 2,50" [(ngModel)]="dividends" name="dividends" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)" required>
            </div>
            <div class="form-group">
              <label for="eps">Lucro por Ação (R$):</label>
              <input type="text" id="eps" placeholder="Ex: 5,00" [(ngModel)]="eps" name="eps" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)" required>
            </div>
            <div class="form-group">
              <label for="growthRate">Taxa de Crescimento (%):</label>
              <input type="text" id="growthRate" placeholder="Ex: 5" [(ngModel)]="growthRate" name="growthRate" data-type="percentage" (input)="formatPercentageInput($event, true)" (blur)="formatPercentageBlur($event, true)" required>
            </div>
            <div class="form-group">
              <label for="payout">Payout Ratio (%):</label>
              <input type="text" id="payout" placeholder="Ex: 50" [(ngModel)]="payout" name="payout" data-type="percentage" (input)="formatPercentageInput($event, true)" (blur)="formatPercentageBlur($event, true)" required>
            </div>
            <div class="form-group">
              <label for="marketPrice">Preço Atual de Mercado (R$):</label>
              <input type="text" id="marketPrice" placeholder="Ex: 50,00" [(ngModel)]="marketPrice" name="marketPrice" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)" required>
            </div>
          </div>
          <div class="button-container">
            <button type="submit" class="calculate-button">Calcular</button>
          </div>
        </form>
        <section id="results" class="results-section" [style.display]="showResultsCeilingPrice ? 'block' : 'none'">
          <h2>Resultados</h2>
          <div class="result-item">
            <p>Preço Teto:</p>
            <span id="ceilingPrice">{{ ceilingPrice | currency:'BRL' }}</span>
          </div>
          <div class="result-item">
            <p>Margem de Segurança:</p>
            <span id="marginSafety">{{ marginSafety | number:'1.2-2' }}%</span>
          </div>
          <div class="result-item">
            <p>Status:</p>
            <span id="status">{{ status }}</span>
          </div>
          <div class="chart-container">
            <canvas id="priceChart"></canvas>
          </div>
          <div class="download-buttons">
            <button id="downloadPngCeilingPrice" class="download-button" (click)="downloadPng('ceilingPrice')">Baixar PNG</button>
            <button id="downloadPdfCeilingPrice" class="download-button" (click)="downloadPdf('ceilingPrice')">Baixar PDF</button>
          </div>
        </section>
      </div>
    </mat-tab>

    <!-- Tab 3: Simulador de Investimentos -->
    <mat-tab label="Simulador de Investimentos">
      <div class="container" id="investment">
        <header class="header">
          <h1>Simulador de Investimentos</h1>
        </header>
        <main class="main-content">
          <form id="investmentForm" class="investment-form" (ngSubmit)="onSubmitInvestment()">
            <div class="form-group full-width-select">
              <label for="investmentType">Tipo de Investimento:</label>
              <div class="select-wrapper">
                <select id="investmentType" [(ngModel)]="investmentType" name="investmentType" (ngModelChange)="toggleFields()">
                  <option value="">Selecione...</option>
                  <option value="rendaFixa">Renda Fixa</option>
                  <option value="rendaVariavel">Renda Variável</option>
                </select>
              </div>
            </div>
            <div id="rendaFixaFields" class="investment-fields" [class.hidden]="investmentType !== 'rendaFixa'">
              <div class="form-row">
                <div class="form-group">
                  <label for="initialAmountRF">Valor Inicial (R$):</label>
                  <input type="text" id="initialAmountRF" placeholder="Ex: 1.000,00" [(ngModel)]="initialAmountRF" name="initialAmountRF" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)">
                </div>
                <div class="form-group">
                  <label for="monthlyContributionRF">Aporte Mensal (R$):</label>
                  <input type="text" id="monthlyContributionRF" placeholder="Ex: 100,00" [(ngModel)]="monthlyContributionRF" name="monthlyContributionRF" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="interestRateRF">Taxa de Juros Anual (%):</label>
                  <input type="text" id="interestRateRF" placeholder="Ex: 10,00" [(ngModel)]="interestRateRF" name="interestRateRF" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)">
                </div>
                <div class="form-group">
                  <label for="timeRF">Tempo de Investimento: <span id="timeValueRF">{{ timeRF }}</span> <span id="timeUnitRF">{{ timeUnitRF }}</span></label>
                  <input type="range" id="timeRF" min="1" [max]="timeUnitSelectorRF === 'months' ? 600 : 50" [(ngModel)]="timeRF" name="timeRF" (input)="updateTimeRF()">
                </div>
              </div>
              <div class="form-group full-width-select">
                <label for="timeUnitSelectorRF">Unidade de Tempo:</label>
                <div class="select-wrapper">
                  <select id="timeUnitSelectorRF" [(ngModel)]="timeUnitSelectorRF" name="timeUnitSelectorRF" (ngModelChange)="updateTimeSliderRF()">
                    <option value="months">Meses</option>
                    <option value="years"> Anos</option>
                  </select>
                </div>
              </div>
            </div>
            <div id="rendaVariavelFields" class="investment-fields" [class.hidden]="investmentType !== 'rendaVariavel'">
              <div class="form-row">
                <div class="form-group">
                  <label for="initialAmountRV">Valor Inicial (R$):</label>
                  <input type="text" id="initialAmountRV" placeholder="Ex: 5.000,00" [(ngModel)]="initialAmountRV" name="initialAmountRV" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)">
                </div>
                <div class="form-group">
                  <label for="monthlyContributionRV">Aporte Mensal (R$):</label>
                  <input type="text" id="monthlyContributionRV" placeholder="Ex: 200,00" [(ngModel)]="monthlyContributionRV" name="monthlyContributionRV" data-type="currency" (input)="formatInput($event)" (blur)="formatCurrency($event)">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="expectedReturnRV">Retorno Esperado Anual (%):</label>
                  <input type="text" id="expectedReturnRV" placeholder="Ex: 15,00" [(ngModel)]="expectedReturnRV" name="expectedReturnRV" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)">
                </div>
                <div class="form-group">
                  <label for="dividendYieldRV">% de Dividendos Pagos Anual:</label>
                  <input type="text" id="dividendYieldRV" placeholder="Ex: 3,00" [(ngModel)]="dividendYieldRV" name="dividendYieldRV" data-type="percentage" (input)="formatPercentageInput($event)" (blur)="formatPercentageBlur($event)">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="timeRV">Tempo de Investimento: <span id="timeValueRV">{{ timeRV }} </span> <span id="timeUnitRV">{{ timeUnitRV }}</span></label>
                  <input type="range" id="timeRV" min="1" [max]="timeUnitSelectorRV === 'months' ? 600 : 50" [(ngModel)]="timeRV" name="timeRV" (input)="updateTimeRV()">
                </div>
                <div class="form-group full-width-select">
                  <label for="timeUnitSelectorRV">Unidade de Tempo:</label>
                  <div class="select-wrapper">
                    <select id="timeUnitSelectorRV" [(ngModel)]="timeUnitSelectorRV" name="timeUnitSelectorRV" (ngModelChange)="updateTimeSliderRV()">
                      <option value="months">Meses</option>
                      <option value="years" selected> Anos</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <button type="submit" id="simulateButton" class="simulate-button" [disabled]="!investmentType">Simular</button>
          </form>
          <section id="results" class="results-section" [class.hidden]="!showResultsInvestment">
            <h2>Resultados da Simulação</h2>
            <div class="result-item">
              <p>Valor Total Investido: <span id="totalInvested">{{ totalInvested | currency:'BRL' }}</span></p>
            </div>
            <div class="result-item">
              <p>Rendimento Total: <span id="totalReturn">{{ totalReturn | currency:'BRL' }}</span></p>
            </div>
            <div class="result-item" id="dividendsPaidItem" [class.hidden]="investmentType !== 'rendaVariavel'">
              <p>Total de Dividendos: <span id="totalDividends">{{ totalDividends | currency:'BRL' }}</span></p>
            </div>
            <div class="result-item">
              <p>Valor Total Bruto: <span id="grossTotal">{{ grossTotal | currency:'BRL' }}</span></p>
            </div>
            <div class="result-item" id="finalValueNetItem" [class.hidden]="investmentType !== 'rendaFixa'">
              <p>Valor Total Líquido (após impostos/taxas): <span id="netTotal">{{ netTotal | currency:'BRL' }}</span></p>
            </div>
            <p class="disclaimer">*Os valores apresentados são estimativas e podem variar.</p>
          </section>
        </main>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
