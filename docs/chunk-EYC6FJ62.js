import{d as ye,f as Ie,h as Ae,i as Ue}from"./chunk-XH4VFE4G.js";import{g as Me}from"./chunk-7LU7E6A7.js";import{a as Ce,b as Ee}from"./chunk-W7U3TC47.js";import{b as x,c as N,d as C,e as ie,g as O,j as E}from"./chunk-RHZ2YEUC.js";import{d as _e,e as Fe}from"./chunk-WNPO2FMP.js";import{Bb as me,Cc as v,Db as M,Gb as de,Hb as ce,La as ae,Nb as ue,Qb as pe,Rb as fe,Ta as V,Tb as ve,Xb as he,Yb as ge,Zb as Se,a as Y,ic as Pe,kc as we,l as Z,m as ee,n as te,na as re,rb as oe,sb as ne,sc as be,tc as z,xc as xe,yb as le,zb as se}from"./chunk-W7CMP73G.js";import{Aa as U,Ba as T,Cc as Q,Dc as n,Dd as X,Ec as p,Fc as D,Hb as P,Kc as W,L,Ob as h,Q as G,Rc as F,Sc as y,Vb as w,bc as g,da as q,ga as $,gc as o,hc as a,ic as d,ja as H,mc as J,pa as u,pc as b,qb as k,rc as S,t as _,tb as l,uc as K,x as B}from"./chunk-3X4KAICN.js";var ke=(()=>{class r{constructor(){this.auth=u(v),this.router=u(ee)}ngOnInit(){this.auth.user().subscribe(e=>this.user=e)}logout(){this.auth.logout().subscribe(()=>{this.router.navigateByUrl("/auth/login")})}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=P({type:r,selectors:[["app-profile-layout"]],decls:31,vars:14,consts:[[1,"bg-dark","text-light",3,"title"],[1,"row"],[1,"col-sm-4","col-md-4","col-lg-3"],[1,"text-center"],["alt","","width","80",1,"m-b-8","r-full",3,"src"],[1,"m-t-0","m-b-8","f-w-400"],[1,"m-t-0","text-grey-500"],[1,"m-t-16","m-b-8"],["mat-list-item","","routerLink","/profile/overview"],["matListItemIcon",""],["mat-list-item","","routerLink","/profile/settings"],["mat-list-item","","tabindex","0",3,"click","keydown.enter"],[1,"col-sm-8","col-md-8","col-lg-9"]],template:function(i,t){i&1&&(d(0,"page-header",0),F(1,"translate"),o(2,"div",1)(3,"div",2)(4,"mat-card")(5,"mat-card-content")(6,"div",3),d(7,"img",4),o(8,"h2",5),n(9),a(),o(10,"p",6),n(11,"Let's make money."),a()(),d(12,"mat-divider",7),o(13,"mat-nav-list")(14,"a",8)(15,"mat-icon",9),n(16,"account_circle"),a(),n(17),F(18,"translate"),a(),o(19,"a",10)(20,"mat-icon",9),n(21,"edit"),a(),n(22),F(23,"translate"),a(),o(24,"a",11),b("click",function(){return t.logout()})("keydown.enter",function(){return t.logout()}),o(25,"mat-icon",9),n(26,"exit_to_app"),a(),n(27),F(28,"translate"),a()()()()(),o(29,"div",12),d(30,"router-outlet"),a()()),i&2&&(K("title",y(1,6,"profile")),l(7),w("src",t.user.avatar,k),l(2),p(t.user.username),l(8),D(" ",y(18,8,"profile")," "),l(5),D(" ",y(23,10,"edit_profile")," "),l(5),D(" ",y(28,12,"logout")," "))},dependencies:[te,Z,V,E,x,C,Ee,Ce,Ue,Ae,Ie,ye,z,be,xe,we,Pe],encapsulation:2})}}return r})();var De=(()=>{class r{constructor(){this.authService=u(v),this.user=this.authService.user().getValue()}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=P({type:r,selectors:[["app-profile-overview"]],decls:16,vars:2,consts:[[1,"section-title"],[1,"demo-card"]],template:function(i,t){i&1&&(o(0,"mat-card")(1,"section",0)(2,"mat-card-header")(3,"mat-card-title")(4,"h2"),n(5),a()(),o(6,"mat-card-subtitle")(7,"p"),n(8),a()()(),o(9,"mat-card",1)(10,"mat-card-content"),n(11," The German Shepherd is a breed of medium to large-sized working dog that originated in Germany. The breed's officially recognized name is German Shepherd Dog in the English language. The breed is also known as the Alsatian in Britain and Ireland. "),a(),o(12,"mat-card-content"),n(13," The German Shepherd is a breed of medium to large-sized working dog that originated in Germany. The breed's officially recognized name is German Shepherd Dog in the English language. The breed is also known as the Alsatian in Britain and Ireland. "),a(),o(14,"mat-card-content"),n(15," People also search for Rottweiler, Siberian Husky, Labrador Retriever, Doberman Pinscher "),a()()()()),i&2&&(l(5),p(t.user.username),l(3),p(t.user.email))},dependencies:[E,x,C,O,ie,N,Me],styles:[".section-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:200;color:var(--text-secondary);padding:5px;margin:5px}"]})}}return r})();var R=(()=>{class r{constructor(){this.http=u(Y),this.authService=u(v),this.apiUsuariosPrefix="/api/usuarios/",this.apiAvatarsPrefix="/api/avatars/"}getUsuarioIdObservable(){return this.authService.user().pipe(G(1),B(e=>e?.id))}getProfile(){return this.getUsuarioIdObservable().pipe(q(e=>{if(e==null)return console.error("SettingsService: ID do usu\xE1rio n\xE3o dispon\xEDvel para buscar perfil."),_(null);let i=`${this.apiUsuariosPrefix}${e}`;return console.log(`SettingsService: Solicitando perfil para usu\xE1rio ID: ${e} da URL: ${i}`),this.http.get(i).pipe($(t=>console.log(`SettingsService: Perfil recebido para usu\xE1rio ${e}:`,t)),L(t=>(console.error(`SettingsService: Erro ao buscar perfil para usu\xE1rio ${e}:`,t),_(null))))}))}updateProfile(e){return this.getUsuarioIdObservable().pipe(q(i=>{if(i==null)return console.error("SettingsService: ID do usu\xE1rio n\xE3o dispon\xEDvel para atualizar perfil."),_(null);let t=`${this.apiUsuariosPrefix}${i}`;return console.log(`SettingsService: Enviando atualiza\xE7\xE3o de perfil para usu\xE1rio ID: ${i} da URL: ${t}`),this.http.put(t,e).pipe($(s=>console.log(`SettingsService: Perfil atualizado com sucesso para usu\xE1rio ${i}:`,s)),L(s=>(console.error(`SettingsService: Erro ao atualizar perfil para usu\xE1rio ${i}:`,s),_(null))))}))}getFullAvatarUrl(e){return e==null?"":`${this.apiAvatarsPrefix}${e}`}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275prov=H({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function Oe(r,f){if(r&1&&(o(0,"mat-error",8),n(1),a()),r&2){let e=S();l(),p(e.avatarError)}}function Ve(r,f){if(r&1&&(o(0,"mat-error"),n(1),a()),r&2){let e=S();l(),p(e.getErrorMessage("username"))}}function ze(r,f){if(r&1&&(o(0,"mat-error"),n(1),a()),r&2){let e=S();l(),p(e.getErrorMessage("email"))}}function Le(r,f){if(r&1&&(o(0,"mat-error"),n(1),a()),r&2){let e=S();l(),p(e.getPasswordErrorMessage())}}function qe(r,f){if(r&1&&(o(0,"mat-error"),n(1),a()),r&2){let e=S();l(),p(e.getErrorMessage("estrategia"))}}function $e(r,f){if(r&1&&(o(0,"mat-error"),n(1),a()),r&2){let e=S();l(),p(e.getErrorMessage("perfil"))}}function je(r){let f=r.get("password"),e=r.get("confirmPassword");return!f||!e?null:!f.value&&!e.value?(e.setErrors(null),null):f.value!==e.value?(e.setErrors({passwordMismatch:!0}),{passwordMismatch:!0}):(e.hasError("passwordMismatch")&&e.setErrors(null),null)}var Ne=(()=>{class r{constructor(){this.auth=u(v),this.fb=u(he),this.settingsService=u(R),this.selectedFile=null,this.avatarPreviewUrl=null,this.avatarError=null,this.defaultAvatarPlaceholder="images/avatar.jpg"}ngOnInit(){this.auth.user().subscribe(e=>{this.user=e,this.loadUserData()}),this.reactiveForm=this.fb.group({username:this.fb.control("",{validators:[M.required],nonNullable:!0}),email:this.fb.control("",{validators:[M.required,M.email],nonNullable:!0}),password:this.fb.control("",{nonNullable:!0}),confirmPassword:this.fb.control("",{nonNullable:!0}),estrategia:this.fb.control("",{validators:[M.required],nonNullable:!0}),perfil:this.fb.control("",{validators:[M.required],nonNullable:!0}),avatarIdentifier:this.fb.control(void 0),id:this.fb.control(void 0)},{validators:je})}loadUserData(){this.settingsService.getProfile().subscribe({next:e=>{e?(this.reactiveForm.patchValue({username:e.username,email:e.email,estrategia:e.estrategia,perfil:e.perfil,id:e.id}),e.avatarIdentifier!==void 0&&e.avatarIdentifier!==null?(this.avatarPreviewUrl=this.settingsService.getFullAvatarUrl(e.avatarIdentifier),this.reactiveForm.get("avatarIdentifier")?.patchValue(e.avatarIdentifier)):this.avatarPreviewUrl=this.defaultAvatarPlaceholder):(console.warn("N\xE3o foi poss\xEDvel carregar os dados do perfil ou usu\xE1rio n\xE3o encontrado. Exibindo placeholder."),this.avatarPreviewUrl=this.defaultAvatarPlaceholder)},error:e=>{console.error("Erro inesperado ao carregar dados do usu\xE1rio no componente:",e),this.avatarPreviewUrl=this.defaultAvatarPlaceholder}})}onFileSelected(e){let i=e.target;if(i.files&&i.files.length>0){let t=i.files[0];if(this.avatarError=null,!["image/jpeg","image/png"].includes(t.type)){this.avatarError="Apenas arquivos JPEG e PNG s\xE3o permitidos.",this.selectedFile=null,this.avatarPreviewUrl=this.defaultAvatarPlaceholder,i.value="";return}let m=2*1024*1024;if(t.size>m){this.avatarError="O tamanho do arquivo n\xE3o pode exceder 2MB.",this.selectedFile=null,this.avatarPreviewUrl=this.defaultAvatarPlaceholder,i.value="";return}this.selectedFile=t;let c=new FileReader;c.onload=()=>{this.avatarPreviewUrl=c.result},c.readAsDataURL(t)}else{this.selectedFile=null;let t=this.reactiveForm.get("avatarIdentifier")?.value;this.avatarPreviewUrl=t!=null?this.settingsService.getFullAvatarUrl(t):this.defaultAvatarPlaceholder}}getErrorMessage(e){let i=this.reactiveForm.get(e);return!i||!i.touched?"":i.hasError("required")?"Este campo \xE9 obrigat\xF3rio.":i.hasError("email")?"Por favor, insira um e-mail v\xE1lido.":""}getPasswordErrorMessage(){let e=this.reactiveForm.get("confirmPassword");return!e||!e.touched?"":e.hasError("passwordMismatch")?"As senhas n\xE3o coincidem.":""}onSubmit(){this.reactiveForm.markAllAsTouched();let e=this.reactiveForm.get("password")?.value,i=this.reactiveForm.get("confirmPassword")?.value;if(e&&e.length>0){if(!i||i.length===0){this.reactiveForm.get("confirmPassword")?.setErrors({required:!0}),this.reactiveForm.get("confirmPassword")?.markAsTouched(),console.log("Confirma\xE7\xE3o de senha \xE9 obrigat\xF3ria quando a senha \xE9 preenchida.");return}if(e!==i){this.reactiveForm.get("confirmPassword")?.setErrors({passwordMismatch:!0}),this.reactiveForm.get("confirmPassword")?.markAsTouched(),console.log("As senhas n\xE3o coincidem.");return}}else this.reactiveForm.get("confirmPassword")?.setErrors(null);if(this.reactiveForm.invalid&&!this.selectedFile){console.log("Formul\xE1rio inv\xE1lido e nenhum arquivo de avatar selecionado. N\xE3o ser\xE1 enviado.");return}let t=new FormData,s=this.reactiveForm.getRawValue();t.append("username",s.username),t.append("email",s.email),t.append("estrategia",s.estrategia),t.append("perfil",s.perfil),s.password&&s.password.length>0&&t.append("password",s.password),this.selectedFile&&t.append("avatar",this.selectedFile,this.selectedFile.name),this.settingsService.updateProfile(t).subscribe({next:m=>{m?(console.log("Perfil atualizado com sucesso!",m),alert("Perfil atualizado com sucesso!"),m.avatarIdentifier!==void 0&&m.avatarIdentifier!==null?(this.avatarPreviewUrl=this.settingsService.getFullAvatarUrl(m.avatarIdentifier),this.reactiveForm.get("avatarIdentifier")?.patchValue(m.avatarIdentifier)):this.loadUserData()):(console.error("Erro ao atualizar perfil: Resposta nula ou erro no servi\xE7o."),alert("Erro ao atualizar perfil. Verifique o console.")),this.selectedFile=null,this.reactiveForm.get("password")?.reset(""),this.reactiveForm.get("confirmPassword")?.reset(""),this.reactiveForm.markAsPristine(),this.reactiveForm.markAsUntouched()},error:m=>{console.error("Erro inesperado ao atualizar perfil no componente:",m),alert("Erro ao atualizar perfil. Verifique o console.")}})}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=P({type:r,selectors:[["app-profile-settings"]],features:[W([re(),R])],decls:52,vars:9,consts:[["fileInput",""],[1,"m-b-16"],[1,"form-field-full",3,"formGroup"],[1,"row"],[1,"col-12","m-b-16","d-flex","flex-column","align-items-center"],["alt","Avatar Preview",1,"avatar-preview","m-b-8",3,"src"],["type","file","accept","image/jpeg, image/png",2,"display","none",3,"change"],["mat-stroked-button","","color","primary","type","button",3,"click"],[1,"m-t-8"],[1,"col-sm-6","col-xl-4"],["matInput","","placeholder","Seu nome","formControlName","username","required",""],["matInput","","placeholder","Seu email","formControlName","email","required",""],["matInput","","type","password","placeholder","Nova senha (opcional)","formControlName","password"],["matInput","","type","password","placeholder","Confirme a nova senha","formControlName","confirmPassword"],["matInput","","placeholder","Sua estrat\xE9gia","formControlName","estrategia","required",""],["matInput","","placeholder","Seu perfil","formControlName","perfil","required",""],[1,"d-flex","justify-content-center","m-t-16"],["mat-flat-button","","color","primary","type","submit",3,"click","disabled"]],template:function(i,t){if(i&1){let s=J();o(0,"mat-card")(1,"mat-card-header",1)(2,"mat-card-title"),n(3,"Editar Perfil"),a()(),o(4,"mat-card-content")(5,"form",2)(6,"div",3)(7,"div",4),d(8,"img",5),o(9,"input",6,0),b("change",function(c){return U(s),T(t.onFileSelected(c))}),a(),o(11,"button",7),b("click",function(){U(s);let c=Q(10);return T(c.click())}),n(12," Upload Avatar "),a(),h(13,Oe,2,1,"mat-error",8),a(),o(14,"div",9)(15,"mat-form-field")(16,"mat-label"),n(17,"Nome"),a(),d(18,"input",10),h(19,Ve,2,1,"mat-error"),a()(),o(20,"div",9)(21,"mat-form-field")(22,"mat-label"),n(23,"Email"),a(),d(24,"input",11),h(25,ze,2,1,"mat-error"),a()(),o(26,"div",9)(27,"mat-form-field")(28,"mat-label"),n(29,"Senha"),a(),d(30,"input",12),a()(),o(31,"div",9)(32,"mat-form-field")(33,"mat-label"),n(34,"Confirmar Senha"),a(),d(35,"input",13),h(36,Le,2,1,"mat-error"),a()(),o(37,"div",9)(38,"mat-form-field")(39,"mat-label"),n(40,"Estrat\xE9gia"),a(),d(41,"input",14),h(42,qe,2,1,"mat-error"),a()(),o(43,"div",9)(44,"mat-form-field")(45,"mat-label"),n(46,"Perfil"),a(),d(47,"input",15),h(48,$e,2,1,"mat-error"),a()()(),o(49,"div",16)(50,"button",17),b("click",function(){return U(s),T(t.onSubmit())}),n(51," Salvar "),a()()()()()}if(i&2){let s,m,c,I,A;l(5),w("formGroup",t.reactiveForm),l(3),w("src",t.avatarPreviewUrl||t.defaultAvatarPlaceholder,k),l(5),g(t.avatarError?13:-1),l(6),g((s=t.reactiveForm.get("username"))!=null&&s.invalid&&((s=t.reactiveForm.get("username"))!=null&&s.touched)?19:-1),l(6),g((m=t.reactiveForm.get("email"))!=null&&m.invalid&&((m=t.reactiveForm.get("email"))!=null&&m.touched)?25:-1),l(11),g((c=t.reactiveForm.get("confirmPassword"))!=null&&c.invalid&&((c=t.reactiveForm.get("confirmPassword"))!=null&&c.touched)?36:-1),l(6),g((I=t.reactiveForm.get("estrategia"))!=null&&I.invalid&&((I=t.reactiveForm.get("estrategia"))!=null&&I.touched)?42:-1),l(6),g((A=t.reactiveForm.get("perfil"))!=null&&A.invalid&&((A=t.reactiveForm.get("perfil"))!=null&&A.touched)?48:-1),l(2),w("disabled",t.reactiveForm.invalid&&!t.selectedFile)}},dependencies:[X,ge,ue,me,de,ce,ve,Se,pe,fe,V,ae,E,x,C,O,N,se,le,oe,ne,Fe,_e,z],styles:['@charset "UTF-8";.avatar-preview[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;object-fit:cover;border:2px solid #ccc;box-shadow:0 2px 4px #0000001a}.m-b-8[_ngcontent-%COMP%]{margin-bottom:8px}.m-b-16[_ngcontent-%COMP%]{margin-bottom:16px}.m-t-8[_ngcontent-%COMP%]{margin-top:8px}.m-t-16[_ngcontent-%COMP%]{margin-top:16px}.d-flex[_ngcontent-%COMP%]{display:flex}.flex-column[_ngcontent-%COMP%]{flex-direction:column}.align-items-center[_ngcontent-%COMP%]{align-items:center}.justify-content-center[_ngcontent-%COMP%]{justify-content:center}']})}}return r})();var zt=[{path:"",component:ke,children:[{path:"",redirectTo:"overview",pathMatch:"full"},{path:"overview",component:De},{path:"settings",component:Ne}]}];export{zt as routes};
