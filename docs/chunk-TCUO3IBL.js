import{d as Ne,f as Le,h as De,i as qe}from"./chunk-XH4VFE4G.js";import{g as Oe}from"./chunk-7LU7E6A7.js";import{a as Ve,b as Ae}from"./chunk-W7U3TC47.js";import{b as N,c as le,d as L,g as se,j as b}from"./chunk-RHZ2YEUC.js";import{d as ke,e as Ue}from"./chunk-WNPO2FMP.js";import{Bb as ge,Cc as v,Db as C,Ec as Te,Gb as he,Hb as ve,La as me,Nb as we,Qb as Pe,Ra as de,Rb as Se,Ta as _,Tb as Me,Xb as be,Yb as _e,Zb as Ce,a as ie,ac as xe,bc as Ee,ic as Fe,kc as ye,l as re,m as oe,n as ne,na as ae,rb as ce,sb as pe,sc as D,tc as x,xc as Ie,yb as ue,zb as fe}from"./chunk-W7CMP73G.js";import{Aa as V,Ba as A,Bb as K,Cc as Z,Dc as l,Dd as te,Ec as f,Fc as k,Fd as U,Hb as M,Kc as ee,L as q,Ob as w,Q as G,Rc as F,Sc as y,Vb as g,Xb as Q,_a as J,bc as P,da as R,g as B,ga as z,gc as n,hc as o,ic as p,ja as H,mc as X,pa as c,pc as h,qb as O,rc as S,t as E,tb as s,uc as Y,x as W}from"./chunk-3X4KAICN.js";var Re=(()=>{class r{constructor(){this.auth=c(v),this.router=c(oe)}ngOnInit(){this.auth.user().subscribe(e=>this.user=e)}logout(){this.auth.logout().subscribe(()=>{this.router.navigateByUrl("/auth/login")})}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=M({type:r,selectors:[["app-profile-layout"]],decls:31,vars:14,consts:[[1,"bg-dark","text-light",3,"title"],[1,"row"],[1,"col-sm-4","col-md-4","col-lg-3"],[1,"text-center"],["alt","","width","80",1,"m-b-8","r-full",3,"src"],[1,"m-t-0","m-b-8","f-w-400"],[1,"m-t-0","text-grey-500"],[1,"m-t-16","m-b-8"],["mat-list-item","","routerLink","/profile/overview"],["matListItemIcon",""],["mat-list-item","","routerLink","/profile/settings"],["mat-list-item","","tabindex","0",3,"click","keydown.enter"],[1,"col-sm-8","col-md-8","col-lg-9"]],template:function(i,t){i&1&&(p(0,"page-header",0),F(1,"translate"),n(2,"div",1)(3,"div",2)(4,"mat-card")(5,"mat-card-content")(6,"div",3),p(7,"img",4),n(8,"h2",5),l(9),o(),n(10,"p",6),l(11,"Let's make money."),o()(),p(12,"mat-divider",7),n(13,"mat-nav-list")(14,"a",8)(15,"mat-icon",9),l(16,"account_circle"),o(),l(17),F(18,"translate"),o(),n(19,"a",10)(20,"mat-icon",9),l(21,"edit"),o(),l(22),F(23,"translate"),o(),n(24,"a",11),h("click",function(){return t.logout()})("keydown.enter",function(){return t.logout()}),n(25,"mat-icon",9),l(26,"exit_to_app"),o(),l(27),F(28,"translate"),o()()()()(),n(29,"div",12),p(30,"router-outlet"),o()()),i&2&&(Y("title",y(1,6,"profile")),s(7),g("src",t.user.avatar,O),s(2),f(t.user.username),s(8),k(" ",y(18,8,"profile")," "),s(5),k(" ",y(23,10,"edit_profile")," "),s(5),k(" ",y(28,12,"logout")," "))},dependencies:[ne,re,_,b,N,L,Ae,Ve,qe,De,Le,Ne,x,D,Ie,ye,Fe],encapsulation:2})}}return r})();var ze=(()=>{class r{constructor(){this.authService=c(v),this.platformId=c(J),this.renderer=c(K),this.settings=c(Te),this.tradingViewScript=null,this.isLoading=!1}ngOnInit(){console.log("ProfileOverviewComponent OnInit")}ngAfterViewInit(){U(this.platformId)&&(console.log("Initial TradingView Widget Load starting..."),this.loadTradingViewWidget().then(()=>{console.log("Initial TradingView Widget script loaded successfully.")}).catch(e=>{console.error("Error loading initial TradingView widget:",e)}))}ngOnDestroy(){U(this.platformId)&&this.destroyTradingViewWidget()}triggerWidgetRefresh(){return B(this,null,function*(){if(this.isLoading){console.log("Refresh already in progress.");return}if(!U(this.platformId)){console.warn("Widget refresh skipped: not in browser environment.");return}this.isLoading=!0,console.log("Attempting to refresh TradingView Widget...");try{yield this.loadTradingViewWidget(),console.log("TradingView widget refresh initiated (script load successful).")}catch(e){console.error("Error during widget refresh:",e)}finally{setTimeout(()=>{this.isLoading=!1,console.log("isLoading flag reset.")},750)}})}loadTradingViewWidget(){return new Promise((e,i)=>{let t=document.querySelector(".tradingview-widget-container");if(!t){let d="TradingView widget container not found. Make sure the div with class .tradingview-widget-container exists in your overview.component.html.";return console.warn(d),i(new Error(d))}this.destroyTradingViewWidget();let a=this.settings.getThemeColor();console.log("Tema detectado para o TradingView:",a);let m={feedMode:"all_symbols",isTransparent:!1,displayMode:"adaptive",width:"100%",height:"450",colorTheme:a,locale:"pt"};this.tradingViewScript=this.renderer.createElement("script"),this.renderer.setAttribute(this.tradingViewScript,"type","text/javascript"),this.renderer.setAttribute(this.tradingViewScript,"src","https://s3.tradingview.com/external-embedding/embed-widget-timeline.js"),this.renderer.setAttribute(this.tradingViewScript,"async","true"),this.tradingViewScript?(this.tradingViewScript.innerHTML=JSON.stringify(m),this.tradingViewScript.onload=()=>{console.log("TradingView script loaded successfully."),e()},this.tradingViewScript.onerror=d=>{console.error("TradingView script failed to load.",d),i(d)},this.renderer.appendChild(t,this.tradingViewScript)):i(new Error("Failed to create TradingView script element."))})}destroyTradingViewWidget(){this.tradingViewScript&&this.tradingViewScript.parentNode&&(this.renderer.removeChild(this.tradingViewScript.parentNode,this.tradingViewScript),this.tradingViewScript=null);let e=document.querySelector(".tradingview-widget-container");if(e){let i=e.querySelector("iframe");i&&i.parentNode&&i.parentNode.removeChild(i)}}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=M({type:r,selectors:[["app-profile-overview"]],decls:5,vars:3,consts:[[1,"tradingview-widget-container",2,"height","450px","width","100%"],[2,"display","flex","justify-content","center","margin-top","10px"],["mat-icon-button","","aria-label","Recarregar widget de cota\xE7\xF5es","matTooltip","Recarregar Cota\xE7\xF5es","matTooltipPosition","above",3,"click","disabled"]],template:function(i,t){i&1&&(p(0,"div",0),n(1,"div",1)(2,"button",2),h("click",function(){return t.triggerWidgetRefresh()}),n(3,"mat-icon"),l(4,"refresh"),o()()()),i&2&&(s(2),g("disabled",t.isLoading),s(),Q("spin-animation",t.isLoading))},dependencies:[b,Oe,x,D,_,de,Ee,xe],styles:["[_nghost-%COMP%]{display:block}.section-title[_ngcontent-%COMP%]{margin-bottom:10px}.tradingview-widget-container[_ngcontent-%COMP%]{width:100%;height:auto;border-radius:10px;overflow:hidden}.tradingview-widget-container__widget[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px}button[mat-icon-button][_ngcontent-%COMP%]   mat-icon.spin-animation[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spinAnimation 1s linear infinite}@keyframes _ngcontent-%COMP%_spinAnimation{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.tradingview-widget-container[_ngcontent-%COMP%]{min-height:450px;width:100%}"]})}}return r})();var $=(()=>{class r{constructor(){this.http=c(ie),this.authService=c(v),this.apiUsuariosPrefix="/api/usuarios/",this.apiAvatarsPrefix="/api/avatars/"}getUsuarioIdObservable(){return this.authService.user().pipe(G(1),W(e=>e?.id))}getProfile(){return this.getUsuarioIdObservable().pipe(R(e=>{if(e==null)return console.error("SettingsService: ID do usu\xE1rio n\xE3o dispon\xEDvel para buscar perfil."),E(null);let i=`${this.apiUsuariosPrefix}${e}`;return console.log(`SettingsService: Solicitando perfil para usu\xE1rio ID: ${e} da URL: ${i}`),this.http.get(i).pipe(z(t=>console.log(`SettingsService: Perfil recebido para usu\xE1rio ${e}:`,t)),q(t=>(console.error(`SettingsService: Erro ao buscar perfil para usu\xE1rio ${e}:`,t),E(null))))}))}updateProfile(e){return this.getUsuarioIdObservable().pipe(R(i=>{if(i==null)return console.error("SettingsService: ID do usu\xE1rio n\xE3o dispon\xEDvel para atualizar perfil."),E(null);let t=`${this.apiUsuariosPrefix}${i}`;return console.log(`SettingsService: Enviando atualiza\xE7\xE3o de perfil para usu\xE1rio ID: ${i} da URL: ${t}`),this.http.put(t,e).pipe(z(a=>console.log(`SettingsService: Perfil atualizado com sucesso para usu\xE1rio ${i}:`,a)),q(a=>(console.error(`SettingsService: Erro ao atualizar perfil para usu\xE1rio ${i}:`,a),E(null))))}))}getFullAvatarUrl(e){return e==null?"":`${this.apiAvatarsPrefix}${e}`}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275prov=H({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function Ge(r,u){if(r&1&&(n(0,"mat-error",8),l(1),o()),r&2){let e=S();s(),f(e.avatarError)}}function He(r,u){if(r&1&&(n(0,"mat-error"),l(1),o()),r&2){let e=S();s(),f(e.getErrorMessage("username"))}}function Je(r,u){if(r&1&&(n(0,"mat-error"),l(1),o()),r&2){let e=S();s(),f(e.getErrorMessage("email"))}}function Ke(r,u){if(r&1&&(n(0,"mat-error"),l(1),o()),r&2){let e=S();s(),f(e.getPasswordErrorMessage())}}function Qe(r,u){if(r&1&&(n(0,"mat-error"),l(1),o()),r&2){let e=S();s(),f(e.getErrorMessage("estrategia"))}}function Xe(r,u){if(r&1&&(n(0,"mat-error"),l(1),o()),r&2){let e=S();s(),f(e.getErrorMessage("perfil"))}}function Ye(r){let u=r.get("password"),e=r.get("confirmPassword");return!u||!e?null:!u.value&&!e.value?(e.setErrors(null),null):u.value!==e.value?(e.setErrors({passwordMismatch:!0}),{passwordMismatch:!0}):(e.hasError("passwordMismatch")&&e.setErrors(null),null)}var je=(()=>{class r{constructor(){this.auth=c(v),this.fb=c(be),this.settingsService=c($),this.selectedFile=null,this.avatarPreviewUrl=null,this.avatarError=null,this.defaultAvatarPlaceholder="images/avatar.jpg"}ngOnInit(){this.auth.user().subscribe(e=>{this.user=e,this.loadUserData()}),this.reactiveForm=this.fb.group({username:this.fb.control("",{validators:[C.required],nonNullable:!0}),email:this.fb.control("",{validators:[C.required,C.email],nonNullable:!0}),password:this.fb.control("",{nonNullable:!0}),confirmPassword:this.fb.control("",{nonNullable:!0}),estrategia:this.fb.control("",{validators:[C.required],nonNullable:!0}),perfil:this.fb.control("",{validators:[C.required],nonNullable:!0}),avatarIdentifier:this.fb.control(void 0),id:this.fb.control(void 0)},{validators:Ye})}loadUserData(){this.settingsService.getProfile().subscribe({next:e=>{e?(this.reactiveForm.patchValue({username:e.username,email:e.email,estrategia:e.estrategia,perfil:e.perfil,id:e.id}),e.avatarIdentifier!==void 0&&e.avatarIdentifier!==null?(this.avatarPreviewUrl=this.settingsService.getFullAvatarUrl(e.avatarIdentifier),this.reactiveForm.get("avatarIdentifier")?.patchValue(e.avatarIdentifier)):this.avatarPreviewUrl=this.defaultAvatarPlaceholder):(console.warn("N\xE3o foi poss\xEDvel carregar os dados do perfil ou usu\xE1rio n\xE3o encontrado. Exibindo placeholder."),this.avatarPreviewUrl=this.defaultAvatarPlaceholder)},error:e=>{console.error("Erro inesperado ao carregar dados do usu\xE1rio no componente:",e),this.avatarPreviewUrl=this.defaultAvatarPlaceholder}})}onFileSelected(e){let i=e.target;if(i.files&&i.files.length>0){let t=i.files[0];if(this.avatarError=null,!["image/jpeg","image/png"].includes(t.type)){this.avatarError="Apenas arquivos JPEG e PNG s\xE3o permitidos.",this.selectedFile=null,this.avatarPreviewUrl=this.defaultAvatarPlaceholder,i.value="";return}let m=2*1024*1024;if(t.size>m){this.avatarError="O tamanho do arquivo n\xE3o pode exceder 2MB.",this.selectedFile=null,this.avatarPreviewUrl=this.defaultAvatarPlaceholder,i.value="";return}this.selectedFile=t;let d=new FileReader;d.onload=()=>{this.avatarPreviewUrl=d.result},d.readAsDataURL(t)}else{this.selectedFile=null;let t=this.reactiveForm.get("avatarIdentifier")?.value;this.avatarPreviewUrl=t!=null?this.settingsService.getFullAvatarUrl(t):this.defaultAvatarPlaceholder}}getErrorMessage(e){let i=this.reactiveForm.get(e);return!i||!i.touched?"":i.hasError("required")?"Este campo \xE9 obrigat\xF3rio.":i.hasError("email")?"Por favor, insira um e-mail v\xE1lido.":""}getPasswordErrorMessage(){let e=this.reactiveForm.get("confirmPassword");return!e||!e.touched?"":e.hasError("passwordMismatch")?"As senhas n\xE3o coincidem.":""}onSubmit(){this.reactiveForm.markAllAsTouched();let e=this.reactiveForm.get("password")?.value,i=this.reactiveForm.get("confirmPassword")?.value;if(e&&e.length>0){if(!i||i.length===0){this.reactiveForm.get("confirmPassword")?.setErrors({required:!0}),this.reactiveForm.get("confirmPassword")?.markAsTouched(),console.log("Confirma\xE7\xE3o de senha \xE9 obrigat\xF3ria quando a senha \xE9 preenchida.");return}if(e!==i){this.reactiveForm.get("confirmPassword")?.setErrors({passwordMismatch:!0}),this.reactiveForm.get("confirmPassword")?.markAsTouched(),console.log("As senhas n\xE3o coincidem.");return}}else this.reactiveForm.get("confirmPassword")?.setErrors(null);if(this.reactiveForm.invalid&&!this.selectedFile){console.log("Formul\xE1rio inv\xE1lido e nenhum arquivo de avatar selecionado. N\xE3o ser\xE1 enviado.");return}let t=new FormData,a=this.reactiveForm.getRawValue();t.append("username",a.username),t.append("email",a.email),t.append("estrategia",a.estrategia),t.append("perfil",a.perfil),a.password&&a.password.length>0&&t.append("password",a.password),this.selectedFile&&t.append("avatar",this.selectedFile,this.selectedFile.name),this.settingsService.updateProfile(t).subscribe({next:m=>{m?(console.log("Perfil atualizado com sucesso!",m),alert("Perfil atualizado com sucesso!"),m.avatarIdentifier!==void 0&&m.avatarIdentifier!==null?(this.avatarPreviewUrl=this.settingsService.getFullAvatarUrl(m.avatarIdentifier),this.reactiveForm.get("avatarIdentifier")?.patchValue(m.avatarIdentifier)):this.loadUserData()):(console.error("Erro ao atualizar perfil: Resposta nula ou erro no servi\xE7o."),alert("Erro ao atualizar perfil. Verifique o console.")),this.selectedFile=null,this.reactiveForm.get("password")?.reset(""),this.reactiveForm.get("confirmPassword")?.reset(""),this.reactiveForm.markAsPristine(),this.reactiveForm.markAsUntouched()},error:m=>{console.error("Erro inesperado ao atualizar perfil no componente:",m),alert("Erro ao atualizar perfil. Verifique o console.")}})}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=M({type:r,selectors:[["app-profile-settings"]],features:[ee([ae(),$])],decls:52,vars:9,consts:[["fileInput",""],[1,"m-b-16"],[1,"form-field-full",3,"formGroup"],[1,"row"],[1,"col-12","m-b-16","d-flex","flex-column","align-items-center"],["alt","Avatar Preview",1,"avatar-preview","m-b-8",3,"src"],["type","file","accept","image/jpeg, image/png",2,"display","none",3,"change"],["mat-stroked-button","","color","primary","type","button",3,"click"],[1,"m-t-8"],[1,"col-sm-6","col-xl-4"],["matInput","","placeholder","Seu nome","formControlName","username","required",""],["matInput","","placeholder","Seu email","formControlName","email","required",""],["matInput","","type","password","placeholder","Nova senha (opcional)","formControlName","password"],["matInput","","type","password","placeholder","Confirme a nova senha","formControlName","confirmPassword"],["matInput","","placeholder","Sua estrat\xE9gia","formControlName","estrategia","required",""],["matInput","","placeholder","Seu perfil","formControlName","perfil","required",""],[1,"d-flex","justify-content-center","m-t-16"],["mat-flat-button","","color","primary","type","submit",3,"click","disabled"]],template:function(i,t){if(i&1){let a=X();n(0,"mat-card")(1,"mat-card-header",1)(2,"mat-card-title"),l(3,"Editar Perfil"),o()(),n(4,"mat-card-content")(5,"form",2)(6,"div",3)(7,"div",4),p(8,"img",5),n(9,"input",6,0),h("change",function(d){return V(a),A(t.onFileSelected(d))}),o(),n(11,"button",7),h("click",function(){V(a);let d=Z(10);return A(d.click())}),l(12," Atualizar avatar "),o(),w(13,Ge,2,1,"mat-error",8),o(),n(14,"div",9)(15,"mat-form-field")(16,"mat-label"),l(17,"Nome"),o(),p(18,"input",10),w(19,He,2,1,"mat-error"),o()(),n(20,"div",9)(21,"mat-form-field")(22,"mat-label"),l(23,"Email"),o(),p(24,"input",11),w(25,Je,2,1,"mat-error"),o()(),n(26,"div",9)(27,"mat-form-field")(28,"mat-label"),l(29,"Senha"),o(),p(30,"input",12),o()(),n(31,"div",9)(32,"mat-form-field")(33,"mat-label"),l(34,"Confirmar Senha"),o(),p(35,"input",13),w(36,Ke,2,1,"mat-error"),o()(),n(37,"div",9)(38,"mat-form-field")(39,"mat-label"),l(40,"Estrat\xE9gia"),o(),p(41,"input",14),w(42,Qe,2,1,"mat-error"),o()(),n(43,"div",9)(44,"mat-form-field")(45,"mat-label"),l(46,"Perfil"),o(),p(47,"input",15),w(48,Xe,2,1,"mat-error"),o()()(),n(49,"div",16)(50,"button",17),h("click",function(){return V(a),A(t.onSubmit())}),l(51," Salvar "),o()()()()()}if(i&2){let a,m,d,I,T;s(5),g("formGroup",t.reactiveForm),s(3),g("src",t.avatarPreviewUrl||t.defaultAvatarPlaceholder,O),s(5),P(t.avatarError?13:-1),s(6),P((a=t.reactiveForm.get("username"))!=null&&a.invalid&&((a=t.reactiveForm.get("username"))!=null&&a.touched)?19:-1),s(6),P((m=t.reactiveForm.get("email"))!=null&&m.invalid&&((m=t.reactiveForm.get("email"))!=null&&m.touched)?25:-1),s(11),P((d=t.reactiveForm.get("confirmPassword"))!=null&&d.invalid&&((d=t.reactiveForm.get("confirmPassword"))!=null&&d.touched)?36:-1),s(6),P((I=t.reactiveForm.get("estrategia"))!=null&&I.invalid&&((I=t.reactiveForm.get("estrategia"))!=null&&I.touched)?42:-1),s(6),P((T=t.reactiveForm.get("perfil"))!=null&&T.invalid&&((T=t.reactiveForm.get("perfil"))!=null&&T.touched)?48:-1),s(2),g("disabled",t.reactiveForm.invalid&&!t.selectedFile)}},dependencies:[te,_e,we,ge,he,ve,Me,Ce,Pe,Se,_,me,b,N,L,se,le,fe,ue,ce,pe,Ue,ke,x],styles:['@charset "UTF-8";.avatar-preview[_ngcontent-%COMP%]{width:150px;height:150px;border-radius:50%;object-fit:cover;border:2px solid #ccc;box-shadow:0 2px 4px #0000001a}.m-b-8[_ngcontent-%COMP%]{margin-bottom:8px}.m-b-16[_ngcontent-%COMP%]{margin-bottom:16px}.m-t-8[_ngcontent-%COMP%]{margin-top:8px}.m-t-16[_ngcontent-%COMP%]{margin-top:16px}.d-flex[_ngcontent-%COMP%]{display:flex}.flex-column[_ngcontent-%COMP%]{flex-direction:column}.align-items-center[_ngcontent-%COMP%]{align-items:center}.justify-content-center[_ngcontent-%COMP%]{justify-content:center}']})}}return r})();var Zt=[{path:"",component:Re,children:[{path:"",redirectTo:"overview",pathMatch:"full"},{path:"overview",component:ze},{path:"settings",component:je}]}];export{Zt as routes};
